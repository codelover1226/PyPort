<!DOCTYPE html>
<html>
   <head>
      <title> Stimmungskompass </title>
      <meta charset="utf-8" />
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <!-- Open Graph / Facebook -->
      <meta property="og:type" content="website">
      <meta property="og:url" content="https://www.stimmungskompass.at/">
      <meta property="og:title" content="Stimmungskompass - Eine Plattform zur Bürgerbeteiligung">
      <meta property="og:description" content="Eine Plattform zur Bürgerbeteiligung. Engagiere dich für eine bessere Stadt!">
      <meta property="og:image" content="https://www.stimmungskompass.at/static/facebook_card.png">
      <!-- Twitter -->
      <meta property="twitter:card" content="summary_large_image">
      <meta property="twitter:url" content="https://www.stimmungskompass.at/">
      <meta property="twitter:title" content="Stimmungskompass - Eine Plattform zur Bürgerbeteiligung">
      <meta property="twitter:description" content="Eine Plattform zur Bürgerbeteiligung. Engagiere dich für eine bessere Stadt!">
      <meta property="twitter:image" content="https://www.stimmungskompass.at/static/twitter_card.png">
      <link rel="icon" type="image/x-icon" href="{{ url_for('serve_image', filename='favicon.ico') }}">
      <link rel="icon" href="{{ url_for('favicon') }}" type="image/x-icon">
      <!-- Leaflet CSS -->
      <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
      <link rel="manifest" href="{{ url_for('serve_image', filename='site.webmanifest') }}">
      <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
      </script>
      <script src="static/spamFilter.js"></script>
      <!-- Leaflet Draw CSS -->
      <link href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.css" rel="stylesheet" />
      <!-- Leaflet Draw JavaScript -->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.js"></script>
      <!-- Heatmap plugin -->
      <!-- JQuery -->
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
      <!-- Include Spectrum's CSS from CDN -->
      <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/spectrum/1.8.1/spectrum.min.css" />
      <!-- Include Spectrum's JavaScript from CDN -->
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/spectrum/1.8.1/spectrum.min.js"></script>
      <div id="landscape-blocker" style="display: none;">
         <p>Der Stimmungskompass ist nur im Hochformat verfügbar.</p>
         <img id="anti-rotate-image" src="static/antirotate.png" alt="Rotate Device" style="max-width: 30%; height: auto; display: block; margin: 0 auto;">
      </div>
      <div id="portrait-blocker" style="display: none;">
         <p>Der Stimmungskompass ist nur im Querformat verfügbar.</p>
         <img id="anti-rotate-image" src="static/antirotate_ipad.png" alt="Rotate Device" style="max-width: 30%; height: auto; display: block; margin: 0 auto;">
      </div>
      <style type="text/css">
         background-color: var(--background-color);
         /* Apply background color */
         color: var(--text-color);
         /* Apply text color */
      </style>
   </head>
   <style>
      .overlay-button {
      border-radius: 30px;
      padding: 15px;
      background-color: white;
      font-weight: bold;
      color: black;
      border: none;
      cursor: pointer;
      transition: background-color 0.3s ease;
      /* Smooth transition for background color */
      }
      #marker-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.2);
      z-index: 10000;
      }
      #overlay-content {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: white;
      padding: 20px;
      border-radius: 30px;
      width: 80%;
      max-width: 500px;
      text-align: center;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      }
      /* Mobile Styles */
      @media (max-width: 768px) {
      #overlay-content {
      position: absolute;
      top: calc(9vh + 9px); /* Estimate based on viewport height and gap */
      left: 15px;
      right: 15px;
      bottom: 15px; /* Distance from the bottom of the viewport */
      width: auto; /* Allow width to adjust to left and right margins */
      min-width: calc(100% - 30px); /* Ensure it takes at least the width minus margins */
      height: auto; /* Adjust height automatically */
      padding: 20px;
      box-sizing: border-box; /* Include padding in width/height */
      display: flex;
      flex-direction: column;
      justify-content: center; /* Vertically center content */
      align-items: center; /* Horizontally center content */
      background: white;
      border-radius: 30px;
      margin-top: 7.5px !important;
      z-index: 1500 !important;
      overflow: auto; /* Enables scrolling if content is larger than the overlay */
      transform: none;
      }
      #markers-list-overlay {
      position: absolute; /* Changed from fixed to absolute */
      top: calc(9vh + 9px); /* Estimate based on viewport height and gap */
      left: 15px;
      right: 15px;
      word-wrap: break-word; /* Break long words to prevent horizontal overflow */
      bottom: 15px; /* 15px away from the bottom */
      width: auto; /* Allow width to adjust to left and right margins */
      min-width: calc(100% - 30px); /* Ensure it takes at least the width minus margins */
      height: auto; /* Adjust height automatically */
      padding: 20px;
      box-sizing: border-box; /* Include padding in width/height */
      display: none;
      flex-direction: column;
      justify-content: center; /* Vertically center content */
      align-items: center; /* Horizontally center content */
      background: white;
      border-radius: 30px;
      margin-top: 7.5px !important;
      z-index: 1500 !important;
      overflow: auto; /* Enables scrolling if content is larger than the overlay */
      }
      .leaflet-control-layers-toggle {
      display: none !important;
      }
      }
      .p-mobile-confirm {
      font-size: 18px;
      font-weight: bold;
      color: black;
      }
      @media only screen and (max-width: 767px) {
      .mobile-confirm {
      position: fixed;
      height: 150px;
      bottom: 0;
      left: 15px !important;
      right: 15px !important;
      border-radius: 30px;
      margin-bottom: 15px;
      overflow: hidden;
      width: auto;
      overflow-y: auto;
      /* Enables vertical scrolling */
      background: var(--sidebar-bg);
      /* Use variable for background */
      }
      .register-button-c {
      background-color: #003056;
      /* Example color */
      color: white;
      border: none;
      /* Remove the border */
      outline: none;
      /* Remove the outline */
      box-shadow: none;
      /* Remove any shadow that might appear as an outline */
      border-radius: 30px;
      padding: 3px 3px;
      text-align: center;
      text-decoration: none;
      display: inline-block;
      font-weight: bold;
      font-size: 16px !important;
      margin: auto;
      margin-top: 0px !important;
      margin-bottom: 0px;
      cursor: pointer;
      width: 97%;
      box-sizing: border-box;
      /* Include padding in width */
      }
      .p-mobile-confirm {
      font-size: 16px;
      margin-bottom: 6px;
      }
      }
      @media (min-width: 768px) and (max-width: 1080px) {
      .mobile-confirm {
      position: absolute;
      bottom: 15px;
      /* Align with the bottom of #map */
      right: calc(40% + 0px) !important;
      /* Adjusting for sidebar width and right margin */
      background: #f5f1e4;
      padding: 20px;
      border-radius: 30px;
      transform: none;
      /* Remove the translate transform */
      }
      .register-button-c {
      background-color: #003056;
      /* Example color */
      color: white;
      border: none;
      /* Remove the border */
      outline: none;
      /* Remove the outline */
      box-shadow: none;
      /* Remove any shadow that might appear as an outline */
      border-radius: 30px;
      padding: 5px 10px;
      text-align: center;
      text-decoration: none;
      display: inline-block;
      font-weight: bold;
      font-size: 14px !important;
      margin: auto;
      margin-top: 0px !important;
      margin-bottom: 0px;
      cursor: pointer;
      width: 97%;
      box-sizing: border-box;
      /* Include padding in width */
      }
      .p-mobile-confirm {
      font-size: 16px;
      }
      }
      @media only screen and (min-width: 768px) {
      .mobile-confirm {
      position: absolute;
      bottom: 15px;
      /* Align with the bottom of #map */
      right: calc(30% + 15px);
      background: #f5f1e4;
      padding: 20px;
      border-radius: 30px;
      transform: none;
      /* Remove the translate transform */
      }
      .register-button-c {
      background-color: #003056;
      /* Example color */
      color: white;
      border: none;
      /* Remove the border */
      outline: none;
      /* Remove the outline */
      box-shadow: none;
      /* Remove any shadow that might appear as an outline */
      border-radius: 30px;
      padding: 5px 10px;
      text-align: center;
      text-decoration: none;
      display: inline-block;
      font-weight: bold;
      font-size: 16px;
      margin: auto;
      margin-top: 0px !important;
      margin-bottom: 0px;
      cursor: pointer;
      width: 97%;
      box-sizing: border-box;
      /* Include padding in width */
      }
      }
      /* BASIC CSS START */
      body,
      html {
      margin: 0;
      padding: 0;
      overflow: hidden;
      /* Prevent scrolling */
      box-sizing: border-box;
      /* Include padding and border in the element's total width and height */
      font-family: 'Roboto', sans-serif !important;
      background-color: var(--background-color);
      /* Apply background color */
      color: var(--text-color);
      /* Apply text color */
      }
      .leaflet-tile {
      margin: 0 !important;
      padding: 0 !important;
      border-radius: 0 !important;
      /* Removes rounded corners */
      }
      .resistant-h3 {
      color: var(--text-color);
      /* Use the text color based on the current theme */
      /* Add Andere styles as needed */
      }
      @media only screen and (max-width: 1080px) {
      #nav-links .user-info {
      display: block;
      /* Make it a block element */
      width: 100%;
      /* Full width */
      text-align: center;
      /* Center text horizontally */
      margin: 10px 0;
      /* Optional: adjust top and bottom margin as needed */
      }
      }
      #category-filter,
      #sort-filter {
      display: flex;
      justify-content: center;
      margin-bottom: 10px;
      }
      #category-select,
      #sort-select {
      padding: 5px;
      border: 1px solid #ccc;
      border-radius: 5px;
      }
      .marker-item {
      /* Assuming this class is for individual marker items in the list */
      border-bottom: 1px solid #cccccc; /* Thin gray line */
      padding-bottom: 10px; /* Space below the text and above the line */
      margin-bottom: 10px; /* Space between items in the list */
      }
      #markers-list {
      /* Styles for the list containing the markers */
      list-style-type: none; /* Remove default list styling */
      padding: 0; /* Remove default padding */
      margin: 0; /* Remove default margin */
      }
      /* Adjust the #markers-list-overlay */
      #markers-list-overlay {
      overflow: auto;
      word-wrap: break-word; /* Break long words to prevent horizontal overflow */
      /* Allow scrolling inside the overlay */
      padding-bottom: 20px;
      /* Add some padding at the bottom for better spacing */
      }
      /* Ensure the #markers-list has enough space and doesn't overflow */
      .filterx-container {
      display: none !important;
      }
      /* Add this to your CSS file or within a tag in your HTML */
      .button-hover-effect {
      display: inline-block;
      background-color: #111111;
      padding: 5px 7px;
      text-decoration: none;
      border-radius: 30px;
      margin-top: 10px;
      margin-bottom: 10px;
      transition: transform 0.3s ease, background-color 0.3s ease;
      }
      .button-hover-effect:hover {
      transform: scale(1.005);
      background-color: #111111;
      /* Light blue color */
      }
      .voting-bar {
      width: 100%;
      height: 20px;
      background-color: #ddd;
      border-radius: 30px;
      margin-top: 30px;
      display: flex;
      }
      .upvotes {
      height: 100%;
      background-color: #4caf50;
      border-radius: 30px;
      transition: width 0.3s ease;
      }
      .downvotes {
      height: 100%;
      background-color: #9A031E;
      border-radius: 30px;
      transition: width 0.3s ease;
      }
      #landscape-blocker {
      display: none;
      /* Initially hidden */
      position: fixed;
      /* Overlay the whole screen */
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: black;
      /* Black background */
      color: white;
      /* White text color */
      z-index: 9999;
      /* Ensure it's on top of Andere elements */
      display: flex;
      justify-content: center;
      /* Center horizontally */
      align-items: center;
      /* Center vertically */
      text-align: center;
      /* Ensure text alignment is centered */
      }
      .object-item-text {
      color: var(--text-color);
      /* Use CSS variable for dynamic color */
      }
      /* Optional: Add media query for smaller screens if the text is too large */
      @media (max-width: 768px) {
      #landscape-blocker {
      font-size: 16px;
      }
      }
      #portrait-blocker {
      display: none;
      /* Initially hidden */
      position: fixed;
      /* Overlay the whole screen */
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: black;
      /* Black background */
      color: white;
      /* White text color */
      z-index: 9999;
      /* Ensure it's on top of Andere elements */
      display: flex;
      justify-content: center;
      /* Center horizontally */
      align-items: center;
      /* Center vertically */
      text-align: center;
      /* Ensure text alignment is centered */
      }
      /* Optional: Add media query for larger screens */
      @media (min-width: 768px) {
      #portrait-blocker {
      font-size: 20px;
      }
      }
      *,
      *:before,
      *:after {
      box-sizing: inherit;
      /* Inherit box-sizing */
      }
      /* Desktop Styles */
      @media (min-width: 768px) {
      #map,
      #sidebar {
      position: absolute;
      top: 95px;
      /* Increased from 15px to 95px to accommodate the top bar's height */
      bottom: 15px;
      border-radius: 30px;
      overflow-y: auto;
      /* Enables vertical scrolling */
      }
      /* CSS for sidebar visibility toggle */
      #map.sidebar-visible {
      /* Adjust the following styles according to your layout */
      width: calc(100% - 300px) !ui;
      /* Assuming the sidebar width is 300px */
      /* Andere styles if necessary */
      }
      #map {
      left: 15px;
      right: calc(30% + 15px);
      }
      .markers-sidebar {
      position: absolute;
      top: 95px;
      /* Increased from 15px to 95px to accommodate the top bar's height */
      left: 15px;
      bottom: 15px;
      /* Adjusted bottom position */
      width: 20%;
      background: white;
      border-radius: 30px !important;
      overflow-y: auto;
      z-index: 10030 !important;
      padding: 20px;
      border-right: 1px solid #ccc;
      display: none;
      /* Initially hidden */
      }
      #sidebar {
      position: absolute;
      width: calc(30% - 15px);
      right: 15px;
      top: 95px;
      /* Increased from 15px to 95px to accommodate the top bar's height */
      bottom: 15px;
      padding: 10px;
      border-radius: 30px;
      background: var(--sidebar-bg);
      /* Use variable for background */
      }
      }
      @media (max-width: 768px) {
      .desktop-only {
      display: none;
      }
      .sidebar-visible #map {
      right: 15px;
      /* Full width map on smaller screens */
      }
      }
      #map {
      left: 15px;
      /* Consistent margin from the left */
      right: calc(30% + 15px);
      /* Adjusting for sidebar width and margin */
      }
      #sidebar {
      width: calc(30% - 15px);
      /* Sidebar takes up 30% width minus right margin */
      right: 15px;
      /* Consistent margin from the right */
      padding: 10px;
      }
      /* Custom Scrollbar Styles */
      /* For Webkit (Chrome, Safari, Edge) */
      ::-webkit-scrollbar {
      width: 0px;
      /* Hide scrollbar globally */
      }
      .faded {
      opacity: 0.5;
      /* Adjust the value as needed for the desired faded effect */
      transition: opacity 0.3s ease;
      /* Smooth transition for the opacity change */
      }
      ::-webkit-scrollbar-thumb {
      background-color: transparent;
      /* Invisible scrollbar thumb globally */
      }
      .user-info {
      color: white;
      /* Set the text color to match Andere links */
      margin-right: 20px;
      /* Right margin for spacing */
      font-size: 18px;
      /* Font size similar to Andere links */
      font-weight: bold;
      /* Bold text */
      align-self: center;
      /* Align vertically within the flex container */
      }
      /* Hide scrollbar for IE, Edge, and Firefox */
      body {
      word-wrap: break-word; /* Break long words to prevent horizontal overflow */
      -ms-overflow-style: none;
      /* IE and Edge */
      scrollbar-width: none;
      /* Firefox */
      }
      /* Custom scrollbar for object list */
      #object-list::-webkit-scrollbar {
      width: 6px;
      /* Adjust the width for object list */
      }
      #object-list::-webkit-scrollbar-thumb {
      background-color: #888;
      /* Customize the scrollbar thumb color for object list */
      border-radius: 3px;
      /* Add rounded corners for object list scrollbar */
      }
      #object-list {
      overflow-y: auto;
      /* Enable scrolling for object list */
      max-height: 350px;
      /* Adjust height as needed */
      scrollbar-width: thin;
      /* Use a thin scrollbar for the object list in Firefox */
      -ms-overflow-style: scrollbar;
      /* Enable scrollbar for IE and Edge */
      }
      /* Exception for the scrollbar inside the object list */
      #object-list.custom-scrollbar {
      border-radius: 30px;
      /* Add rounded corners to the object list */
      }
      /* Custom Scrollbar CSS End */
      /* Media Query for Mobile Devices */
      @media only screen and (max-width: 1080px) {
      .button-container .register-button-m,
      button[onclick*="markers-list-overlay"].register-button,
      #add-marker-button.register-button {
      font-size: 14px;
      /* Adjust the font size for mobile devices */
      padding: 10px 15px;
      /* Adjust padding to fit the smaller text */
      }
      #category-toggle-buttons button {
      font-size: 14px !important;
      /* Smaller font size for mobile devices */
      padding: 10px 15px;
      /* Adjusted padding for smaller buttons */
      }
      #custom-confirm button.register-button {
      font-size: 14px;
      /* Decrease the font size for the buttons */
      padding: 8px 10px;
      /* Decrease padding to fit the smaller buttons */
      }
      h3 {
      font-size: 14px;
      /* Slightly smaller font size for the h3 element */
      text-align: center;
      margin-top: 5px;
      display: block;
      }
      .category-label {
      font-size: 18px;
      /* Adjust the font size as needed */
      }
      .project-filter-label {
      font-size: 18px;
      /* Adjust the font size as needed */
      }
      }
      #close-overlay-button {
      width: 100%;
      /* Stretch to fill the container */
      box-sizing: border-box;
      /* Include padding and border in the width */
      display: block;
      /* Display as a block element */
      }
      /* Media Query for Devices Between 1080px and 1400px */
      @media only screen and (min-width: 1081px) and (max-width: 1500px) {
      .button-container .register-button-m,
      button[onclick*="markers-list-overlay"].register-button,
      #add-marker-button.register-button {
      font-size: 16px;
      /* Slightly larger font size for tablet devices */
      padding: 12px 18px;
      /* Adjust padding to fit the larger text */
      }
      #category-toggle-buttons button {
      font-size: 16px !important;
      /* Larger font size for tablet devices */
      padding: 12px 18px;
      /* Adjusted padding for larger buttons */
      }
      #custom-confirm button.register-button {
      font-size: 16px;
      /* Slightly larger font size for the buttons */
      padding: 10px 12px;
      /* Adjust padding to fit the slightly larger buttons */
      }
      h3 {
      font-size: 18px;
      /* Slightly smaller font size for the h3 element */
      text-align: center;
      margin-top: 5px;
      display: block;
      }
      }
      /* CITY PICTURE CSS START */
      .logo-img {
      max-width: 100%;
      width: 100%;
      box-sizing: border-box;
      height: auto;
      display: block;
      margin-left: auto;
      margin-right: auto;
      margin-top: 3px;
      margin-bottom: 8px;
      border-radius: 30px;
      "
      }
      /* CITY PICTURE CSS END */
      /* LEAFLET MAP PILL CSS */
      .leaflet-bar,
      .leaflet-draw-section,
      .leaflet-draw-section {
      border-radius: 30px !important;
      border: none;
      background-color: var(--leaflet-control-bg-dark) !important;
      /* Use variable */
      }
      /* LEAFLET MAP ICONS CSS */
      .leaflet-control-zoom-in,
      .leaflet-control-zoom-out,
      .leaflet-draw-draw-polyline,
      .leaflet-draw-draw-polygon,
      .leaflet-draw-draw-rectangle,
      .leaflet-draw-draw-circle,
      .leaflet-draw-draw-marker,
      .leaflet-draw-draw-circlemarker,
      .leaflet-draw-edit-edit,
      .leaflet-draw-edit-remove {
      background-color: #f5f1e4 !important;
      /* Use variable */
      color: #000000 !important;
      /* Use variable */
      border: none !important;
      font-size: 18px !important;
      line-height: 30px !important;
      width: 30px !important;
      height: 30px !important;
      }
      .leaflet-draw-draw-rectangle {
      background-image: url('rectangle_darkmode_svg.svg');
      /* Replace with the path to your new icon */
      background-size: contain;
      background-repeat: no-repeat;
      background-position: center;
      }
      /* LEAFLET MAP ICONS CSS END */
      .leaflet-draw-draw-marker {
      display: none !important;
      }
      .leaflet-draw-draw-polyline {
      display: none !important;
      }
      .leaflet-draw-draw-circlemarker {
      display: none !important;
      }
      /* LEAFLET MAP ICON COLOR CHANGE WHEN DISABLED CSS START */
      .leaflet-disabled {
      background-color: #3a3a3a !important;
      color: #ffffff !important;
      }
      /* LEAFLET MAP ICON COLOR CHANGE WHEN DISABLED CSS END */
      /* LEAFLET MAP ICON BORDER REMOVAL CSS START */
      .leaflet-control-zoom-in,
      .leaflet-control-zoom-out {
      border-top: none !important;
      border-bottom: none !important;
      border-radius: 0 !important;
      }
      /* LEAFLET MAP ICON BORDER REMOVAL CSS END */
      /* LEAFLET MAP ICON MISC CSS START */
      .leaflet-bar>a:first-child {
      border-top-left-radius: 30px !important;
      border-top-right-radius: 30px !important;
      }
      .leaflet-bar>a:last-child {
      border-bottom-left-radius: 30px !important;
      border-bottom-right-radius: 30px !important;
      }
      .leaflet-control-layers {
      border-radius: 30px;
      opacity: 1;
      }
      .leaflet-control-layers::before {
      content: "";
      background-image: var(--leaflet-control-layers-before-bg);
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      border-radius: 30px;
      background-size: cover;
      opacity: 1;
      }
      /* Hide the background image when the control layers menu is expanded */
      .leaflet-control-layers-expanded::before {
      content: none !important;
      }
      .leaflet-control-layers-expanded .leaflet-control-layers-list {
      margin-top: 0px !important;
      /* Reduces the top margin of each label */
      margin-bottom: 0px !important;
      /* Adjusts the space between each item */
      font-size: 7px !important;
      font-weight: bold;
      padding: 10px;
      /* Added padding here */
      }
      .leaflet-control-layers-separator {
      margin-top: 5px;
      /* Adjusts the space above the separator line */
      margin-bottom: 5px;
      /* Adjusts the space below the separator line */
      }
      .leaflet-popup .leaflet-popup-content-wrapper .leaflet-popup-content {
      font-size: 18px !important;
      }
      /* Your existing rules for .leaflet-control-layers and .leaflet-top leaflet-right had typos, corrected below */
      .leaflet-control-layers.leaflet-control {
      background-color: #f5f1e4 !important;
      border-radius: 30px;
      }
      .leaflet-top.leaflet-right {
      border-radius: 50px;
      }
      .leaflet-popup .shape-image {
      max-width: 512px;
      max-height: 512px;
      display: block;
      margin: 0 auto;
      }
      .leaflet-popup-content-wrapper {
      background-color: #f5f1e4 !important;
      color: #000000 !important;
      border-radius: 30px !important;
      width: auto !important;
      }
      .leaflet-popup-content {
      word-wrap: break-word; /* Break long words to prevent horizontal overflow */
      color: #000000 !important;
      }
      .leaflet-popup-tip {
      display: block;
      /* Optional: hides the tip arrow for a cleaner look */
      background-color: #f5f1e4 !important;
      }
      .leaflet-popup-close-button {
      display: none;
      /* Optional: hides the tip arrow for a cleaner look */
      }
      .leaflet-popup.image-popup .leaflet-popup-tip {
      display: none;
      }
      @media (max-width: 1080px) {
      .leaflet-popup-content {
      word-wrap: break-word; /* Break long words to prevent horizontal overflow */
      width: 200px;
      /* Adjust the width as needed for smaller screens */
      }
      .leaflet-popup-content img {
      width: 100%;
      /* Adjust the image width to fit the popup */
      height: auto;
      /* Maintain aspect ratio */
      max-width: 200px;
      /* Maximum width of the image */
      }
      .leaflet-popup .leaflet-popup-tip-container {
      width: 200px;
      /* Align the tip container with the popup width */
      margin-left: -100px;
      /* Half of the width to center it */
      left: 50%;
      /* Center the tip container */
      }
      }
      #shape-note {
      border-radius: 30px;
      border: none;
      display: block;
      color: #111111;
      width: 100%;
      box-sizing: border-box;
      max-height: 200px;
      height: 75px;
      padding: 5px;
      max-width: 100%;
      margin-bottom: -25px;
      /* Adjust this value as needed to reduce gap */
      font-size: 15px;
      /* Set font size to 15px */
      font-family: MaisonNeue, Segoe UI, Helvetica Neue, -apple-system, system-ui, BlinkMacSystemFont, Roboto, Arial, sans-serif, Apple Color Emoji, Segoe UI Emoji, Segoe UI Symbol;
      /* Set font family to Roboto */
      }
      #shape-note::-webkit-input-placeholder {
      /* Chrome, Opera, Safari */
      color: #111111;
      opacity: 1;
      /* Override any default opacity */
      }
      #shape-note:-ms-input-placeholder {
      /* Internet Explorer 10-11 */
      color: #111111;
      opacity: 1;
      /* Override any default opacity */
      }
      #shape-note::-ms-input-placeholder {
      /* Microsoft Edge */
      color: #111111;
      opacity: 1;
      /* Override any default opacity */
      }
      #shape-note::placeholder {
      /* Most modern browsers */
      color: #111111;
      opacity: 1;
      /* Override any default opacity */
      }
      #save-note,
      #cancel-note {
      background-color: #4CAF50;
      /* Green for save, red for cancel */
      border: none;
      color: white;
      padding: 10px 20px;
      border-radius: 30px;
      cursor: pointer;
      font-weight: bold;
      transition: background-color 0.2s ease-in-out;
      margin-top: 0;
      /* Remove top margin to reduce gap */
      }
      #cancel-note {
      background-color: #9A031E;
      margin-left: 50px;
      /* Adjust this value as needed */
      }
      #save-note:hover {
      background-color: #388E3C;
      /* Darker green for hover effect */
      }
      #cancel-note:hover {
      background-color: #D32F2F;
      /* Darker red for hover effect */
      }
      /* LEAFLET MAP ICON MISC CSS END */
      /* SMALL OPTIONS MENU TOP BUTTON CSS START */
      /* This CSS makes sure the "smalloptionsmenutop" entity is resized properly */
      .smalloptionsmenutop {
      display: flex;
      justify-content: space-between;
      }
      .left-container,
      .right-container {
      display: flex;
      align-items: center;
      }
      .pinlist-div,
      .info-div,
      .lightswitch-div,
      .key-div {
      margin: 0 3px;
      }
      }
      /* Individual icon divs */
      .lightswitch-div,
      .key-div,
      .pinlist-div,
      .info-div {
      flex-direction: row;
      }
      /* Make the containers hidden when screen width is less than 1271px */
      @media (max-width: 1271px) and (min-width: 768px) {
      .left-container,
      .right-container,
      .togglebuttoncontainer {
      display: in-line;
      }
      }
      @media (min-width: 768px) and (max-width: 1271px) {
      #keyDiv img,
      #infoDiv img,
      #pinlistdiv img,
      #lightswitchDiv img {
      max-width: 30px !important;
      /* Set the max-width to 30px for tablet screens */
      height: auto;
      /* Maintain the aspect ratio of the images */
      border-radius: 30px;
      /* Maintain the border radius */
      }
      }
      @media (min-width: 768px) and (max-width: 1271px) {
      .button-s {
      max-height: 30px !important;
      /* Set the max height to 30px for tablet screens */
      padding: 10px;
      /* Adjust padding as needed */
      }
      .button-s h3 {
      font-size: 16px;
      /* Adjust the font size as needed for tablet screens */
      margin: 0;
      /* You might want to reset any default margin */
      }
      }
      /* Icon scaler */
      #keyDiv {
      cursor: pointer;
      margin: 0;
      padding: 0;
      display: flex;
      align-items: center;
      /* Vertically center the image */
      }
      #keyDiv img {
      max-width: 40px;
      /* Adjust size as needed */
      height: auto;
      border-radius: 30px;
      margin: 0;
      }
      #infoDiv {
      cursor: pointer;
      margin: 0;
      padding: 0;
      display: flex;
      align-items: center;
      /* Vertically center the image */
      }
      #infoDiv img {
      max-width: 40px;
      /* Adjust size as needed */
      height: auto;
      border-radius: 30px;
      margin: 0;
      }
      #pinlistdiv {
      cursor: pointer;
      margin: 0;
      padding: 0;
      display: flex;
      align-items: center;
      /* Vertically center the image */
      }
      #pinlistdiv img {
      max-width: 40px;
      /* Adjust size as needed */
      height: auto;
      border-radius: 30px;
      margin: 0;
      }
      #lightswitchDiv {
      cursor: pointer;
      margin: 0;
      padding: 0;
      display: flex;
      align-items: center;
      /* Vertically center the image */
      }
      #lightswitchDiv img {
      max-width: 40px;
      /* Adjust size as needed */
      height: auto;
      border-radius: 30px;
      margin: 0;
      }
      /* SMALL OPTIONS MENU BUTTON CSS END */
      /* BUTTON MAIN UNIVERSAL CSS START */
      .button-u {
      font-weight: bold;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 14px 0;
      padding: 15px;
      box-sizing: border-box;
      cursor: pointer;
      text-decoration: none;
      white-space: normal;
      border-radius: 30px;
      transition: background-color 0.2s ease-in-out;
      color: white;
      text-align: center;
      line-height: 1;
      max-height: 40px;
      width: 100%;
      }
      /* BUTTON MAIN UNIVERSAL CSS END */
      /* BUTTON SMALL SIDEBAR CSS START */
      /* This button is used mainly for Wie funktionierts. */
      .button-s {
      font-weight: bold;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 14px 0;
      padding: 15px;
      box-sizing: border-box;
      cursor: pointer;
      text-decoration: none;
      white-space: normal;
      border-radius: 30px;
      background-color: #111111;
      /* Use a general variable */
      transition: background-color 0.2s ease-in-out;
      color: white;
      text-align: center;
      line-height: 1;
      max-height: 40px;
      width: 100%;
      }
      /* INFO-POPUP CONTAINER CSS START */
      /* Takes care of how big the info-popup is gonna be. This popup shows information about each element on the website. */
      #info-popup {
      padding: 20px;
      max-width: 500px;
      font-size: 14px;
      z-index: 1000;
      /* Make sure the popup appears above the map */
      background-color: var(--popup-bg-color);
      color: var(--popup-text-color);
      }
      #info-popup.admin-pindelete-popup {
      max-width: 300px;
      }
      #info-popup.uigif-counter-popup {
      max-width: 320px;
      }
      #info-popup.uigif-counter-popup img {
      border-radius: 30px;
      }
      #info-popup.admin-pinresize-popup {
      max-width: 300px;
      }
      /* INFO-POPUP CONTAINER CSS END */
      .count-pill {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      display: flex;
      align-items: center;
      padding: 10px;
      border-radius: 30px;
      background-color: white;
      box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.1);
      z-index: 10;
      }
      .color-circle {
      height: 15px;
      width: 15px;
      border-radius: 50%;
      display: inline-block;
      margin-right: 10px;
      /* Adjust as needed */
      }
      .category-symbol {
      height: 25px;
      width: 25px;
      margin-right: 10px;
      /* Adjust as needed */
      }
      #counter-pill {
      position: absolute;
      top: 4.5%;
      left: 50%;
      outline: 2px solid rgba(0, 0, 0, 0.2);
      transform: translate(-50%, -50%);
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 30px;
      padding: 8px 12px;
      /* Increased left and right padding */
      z-index: 1000;
      font-size: 25px;
      font-weight: bold;
      gap: 5px;
      background-color: var(--counter-pill-bg-color);
      color: var(--counter-pill-text-color);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      max-width: 80%;
      /* Increased maximum width */
      }
      .counter-color,
      .marker-btn {
      height: 25px;
      /* Adjusted to match desktop version */
      width: 25px;
      /* Adjusted to match desktop version */
      border-radius: 50%;
      display: inline-block;
      margin-right: 2.5px;
      /* Consistent space after the circle */
      margin-left: 2.5px;
      /* Consistent space after the circle */
      }
      #color-counters,
      #category-counters {
      display: flex;
      padding: 0;
      margin: 0;
      gap: 5px;
      }
      .iframe-container {
      position: relative;
      width: 100%;
      padding-bottom: 56.25%;
      /* Aspect ratio: 16/9 */
      height: 0;
      }
      .iframe-container iframe {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      }
      #color-counters li,
      #category-counters li {
      flex-grow: 1;
      /* Allow each item to grow to fill available space */
      flex-shrink: 1;
      /* Allow each item to shrink if needed */
      display: flex;
      /* Make the list items flex containers */
      justify-content: center;
      /* Center the content horizontally */
      align-items: center;
      /* Center the content vertically */
      max-height: 100%;
      /* Ensure items do not exceed the pill's height */
      }
      /* Adjust the size of the content (icons, text, etc.) inside the list items */
      #color-counters li>*,
      #category-counters li>* {
      max-height: 100%;
      /* Adjusted to allow full height */
      max-width: 100%;
      /* Adjusted to allow full width */
      font-size: 25px;
      /* Consistent font size with the pill */
      }
      .hidden {
      display: none !important; // !important to override any Andere display property
      }
      #popup-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      border-radius: 30px;
      background-color: rgba(0, 0, 0, 0.5);
      /* Overlay background */
      z-index: 1000;
      /* Ensure it's above Andere content */
      }
      #popup-content {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      max-width: calc(100% - 20px);
      /* Max width, minus the gap */
      max-height: calc(100% - 20px);
      /* Max height, minus the gap */
      width: 400px;
      height: 300px;
      background: #fff;
      padding: 20px;
      border-radius: 30px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      z-index: 1001;
      /* Above the overlay */
      overflow: auto;
      /* Add scroll for small screens */
      }
      #popup-content button {
      position: absolute;
      top: 10px;
      right: 10px;
      }
      #close-popup {
      position: absolute;
      top: 0;
      right: 0;
      padding: 0.5em;
      border: none;
      background-color: transparent;
      font-size: 1em;
      cursor: pointer;
      z-index: 1002;
      }
      @media screen and (max-width: 420px) {
      #popup-content {
      width: auto;
      /* Adjust width for very small screens */
      }
      }
      .dismiss-button {
      border-radius: 30px;
      margin-right: 50px;
      /* Add Andere styling as needed, e.g., padding, border, background-color, etc. */
      }
      #popup-text .ql-align-center {
      text-align: center;
      }
      #popup-text .ql-font-serif {
      font-family: 'Times New Roman', serif;
      }
      #popup-text .ql-align-right {
      text-align: right;
      }
      #popup-text .ql-align-justify {
      text-align: justify;
      }
      #popup-text .ql-align-center {
      text-align: center;
      }
      .custom-marker-icon img {
      display: none !important;
      }
      .logged-in-info {
      text-align: center;
      /* Centers the text inside the div */
      padding: 2px 0;
      /* Adds some padding above and below the text */
      background-color: #f5f1e4;
      /* Optional: background color, if you want to highlight the div */
      /* Andere styling as needed, such as font size, color, etc. */
      }
      #popup-text img {
      max-width: 95%;
      /* Ensures the image does not exceed the width of the popup */
      height: auto;
      /* Maintains the aspect ratio of the image */
      display: block;
      /* Allows margin auto to work for horizontal centering */
      margin: 0 auto;
      border-radius: 30px;
      /* Centers the image horizontally */
      }
      /* Hide all cursors inside the map when marker drawing is active */
      .no-cursor .leaflet-container,
      .no-cursor .leaflet-container * {
      cursor: none !important;
      }
      /* Hide the Leaflet draw tooltip */
      .leaflet-draw-tooltip {
      display: none !important;
      }
      .leaflet-control-layers-toggle {
      background-image: url('static/mapicon.png') !important;
      /* Check if this path is correct */
      background-color: transparent;
      background-repeat: no-repeat;
      background-position: center;
      border-radius: 50px;
      width: 36px;
      height: 36px;
      }
      /* Media Query for Mobile Devices */
      @media only screen and (max-width: 767px) {
      .leaflet-popup .leaflet-popup-content-wrapper .leaflet-popup-content {
      font-size: 18px !important;
      }
      }
      :root {
      /* Define default dark mode colors */
      --counter-pill-bg-color: #111111;
      --counter-pill-text-color: white;
      --background-color: #f5f1e4;
      /* Dark mode background */
      --text-color: black;
      /* Dark mode text */
      --sidebar-bg: #d9d4c7;
      /* Dark mode sidebar background */
      --leaflet-control-bg-dark: #111111;
      /* Dark mode background color */
      --leaflet-control-color-dark: white;
      /* Dark mode symbol color */
      --button-close-color-dark: white;
      /* Color for dark mode */
      --button-close-color-light: black;
      /* Color for light mode */
      --outline-hover-color-dark: white;
      /* Outline color for dark mode */
      --leaflet-control-layers-before-bg': url("static/mapicon2b.png");
      --outline-hover-color-light: black;
      /* Outline color for light mode */
      --popup-bg-color-light: rgba(244, 244, 237, 1);
      --popup-text-color-light: black;
      --popup-bg-color-dark: rgba(17, 17, 17, 1);
      --popup-text-color-dark: black;
      }
      .light-mode {
      /* Define light mode colors */
      --counter-pill-bg-color: #f3f4f8;
      --counter-pill-text-color: black;
      --background-color: #ffffff;
      /* Light mode background */
      --text-color: black;
      /* Light mode text */
      --sidebar-bg: #EDF2F4;
      /* Light mode sidebar background */
      --counter-pill-bg-color: #f3f4f8;
      /* Light mode counter pill background */
      --counter-pill-text-color: black;
      /* Light mode counter pill text */
      --leaflet-control-bg-light: #f3f4f8;
      /* Light mode background color */
      --leaflet-control-color-light: black;
      /* Light mode symbol color */
      }
      .leaflet-draw-draw-polyline,
      .leaflet-draw-draw-polygon,
      .leaflet-draw-draw-rectangle,
      .leaflet-draw-draw-circle,
      .leaflet-draw-draw-marker,
      .leaflet-draw-draw-circlemarker,
      .leaflet-draw-edit-edit,
      .leaflet-draw-section {
      visibility: hidden;
      /* Hide the icons */
      }
      /* Tool selection popup styling */
      .container {
      position: relative;
      /* Ensures that child absolute elements are positioned relative to this */
      display: flex;
      flex-direction: column;
      align-items: center;
      z-index: 1;
      /* Ensures the container is above Andere content */
      }
      /* Styles for tool buttons inside the popup */
      .tool-btn {
      background-color: transparent;
      border: none;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      }
      .tool-btn img {
      display: block;
      width: auto;
      height: 30px;
      border-radius: 30px;
      transition: transform 0.2s, outline 0.2s;
      /* Added transition for outline */
      }
      .tool-btn:hover img {
      transform: scale(1.005);
      outline: var(--tool-btn-hover-outline);
      }
      .tool-btn.selected img {
      background-color: rgba(255, 255, 255, 0.3);
      outline: var(--tool-btn-selected-outline);
      }
      .filter-container {
      display: flex;
      justify-content: center;
      /* Center items horizontally */
      flex-wrap: wrap;
      /* Allow items to wrap onto the next line */
      gap: 10px;
      /* Optional: add some space between elements */
      }
      /* If elements wrap, they should take the full width of the line */
      .filter-container>* {
      flex-basis: 100%;
      }
      .type-filter {
      margin-bottom: 50px;
      }
      #mobileCategoryOverlay {
      display: none;
      position: fixed;
      /* Changed from absolute to fixed */
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background-color: rgba(0, 0, 0, 0.8);
      z-index: 100;
      /* Max value */
      overflow: auto;
      justify-content: center;
      align-items: center;
      }
      /* Responsive design */
      @media screen and (min-width: 768px) {
      #mobileCategoryOverlay {
      display: none;
      /* Hide on non-mobile devices */
      }
      }
      .categorybutton {
      opacity: 0;
      font-weight: bold;
      line-height: 1;
      cursor: pointer;
      text-decoration: none;
      display: flex;
      max-width: 90%;
      height: auto;
      box-sizing: border-box;
      border-radius: 30px;
      text-align: center;
      border: none;
      flex-grow: 1;
      flex-shrink: 1;
      padding: 20px 20px !important;
      margin-left: auto !important;
      margin-right: auto !important;
      }
      .categorybutton h3 {
      margin: 0;
      /* Removes any default margin */
      color: white;
      }
      #search-filter-section {
      display: none;
      #admin-map {
      display: none !Important;
      }
   </style>
   <style>
      /* Mobile Styles */
      @media (max-width: 767px) {
      body,
      html {
      padding-left: 15px;
      padding-right: 15px;
      }
      #tool-selection-popup {
      max-width: 70%;
      margin-top: -2.5px !important;
      margin-bottom: 7.5px;
      }
      #map {
      position: absolute;
      top: calc(9vh + 9px);
      /* Estimate based on viewport height and gap */
      bottom: 165px;
      /* Adjust for the fixed height of the sidebar (150px + 15px gap) */
      left: 15px;
      right: 15px;
      border-radius: 30px;
      margin-bottom: 15px;
      margin-top: 7.5px !important;
      z-index: 500 !important;
      }
      #sidebar {
      position: fixed;
      height: 150px;
      bottom: 0;
      left: 15px !important;
      right: 15px !important;
      border-radius: 30px;
      margin-bottom: 15px;
      overflow: hidden;
      width: auto;
      overflow-y: auto;
      /* Enables vertical scrolling */
      background: var(--sidebar-bg);
      /* Use variable for background */
      }
      #sidebar-mobileheader {
      position: fixed;
      top: 15px;
      left: 15px;
      right: 15px;
      margin-bottom: 15px !important;
      border-radius: 30px;
      padding-right: 15px;
      padding-left: 15px;
      padding: 7.5px;
      max-height: 81px;
      z-index: 500 !important;
      /* High z-index */
      background: var(--sidebar-bg);
      /* Use variable for background */
      width: auto;
      /* Fixed width for testing */
      display: block !important;
      /* Force display */
      }
      #sidebar-mobileheader img {
      display: block;
      /* Use block display for the image */
      max-width: 100%;
      /* Limit image width to container width */
      max-height: 64px;
      /* Maximum height for the image */
      height: auto;
      /* Adjust height automatically */
      width: auto;
      /* Adjust width automatically */
      margin: auto;
      /* Center the image if needed */
      object-fit: contain;
      /* Ensure aspect ratio is maintained without stretching */
      }
      .hide-on-mobile {
      display: none !important;
      }
      .appear-on-mobile {
      display: block !important;
      }
      }
      .title-button-container {
      display: flex;
      justify-content: center;
      /* Centering content horizontally */
      align-items: center;
      /* Centering content vertically */
      width: 100%;
      /* Ensure the container takes full width */
      }
      .title-imagebutton {
      margin-right: 10px;
      /* Adds a 10px margin to the right of the title */
      }
      .info-image {
      width: 30px;
      height: 30px;
      border-radius: 50px;
      object-fit: cover;
      z-index: 1002;
      }
      .info-image2 {
      width: 40px;
      height: 40px;
      border-radius: 50px;
      object-fit: cover;
      z-index: 1002;
      }
      #info-link2 {
      position: absolute;
      /* Absolute positioning within the map */
      top: calc(100% - 50px);
      /* Positioned below the Leaflet control layers */
      left: 10px;
      /* Adjust left position as needed */
      z-index: 1002;
      /* Ensure it's above other map elements */
      }
      .info-image {
      display: block;
      /* Ensures the image is properly displayed */
      }
      .info-image:hover {
      transform: scale(1) !important;
      }
      .info-link:hover {
      transform: scale(1) !important;
      }
      #replay-image {
      cursor: pointer;
      /* Resize to 30% of the original size */
      width: 30%;
      height: auto;
      /* Maintain aspect ratio */
      margin-top: 20px;
      /* Space between the video and replay button */
      }
      #replay-image-2 {
      cursor: pointer;
      /* Resize to 30% of the original size */
      width: 30%;
      height: auto;
      /* Maintain aspect ratio */
      margin-top: 20px;
      /* Space between the video and replay button */
      }
      #replay-container {
      display: none;
      /* Initially hidden */
      align-items: center;
      /* Center the content horizontally */
      justify-content: center;
      /* Center the content vertically */
      flex-direction: row;
      /* Align children horizontally */
      }
      #replay-container-2 {
      display: none;
      /* Initially hidden */
      align-items: center;
      /* Center the content horizontally */
      justify-content: center;
      /* Center the content vertically */
      flex-direction: row;
      /* Align children horizontally */
      }
      .video-overlay {
      position: fixed;
      top: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 100vw;
      height: 100vh;
      background: rgba(0, 0, 0, 0.8);
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      z-index: 100000;
      padding: 10px;
      box-sizing: border-box;
      }
      #video-overlay-2 {
      position: fixed;
      /* or 'absolute' depending on layout */
      top: 50%;
      /* Adjust these values as needed */
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 100000;
      /* Ensure it appears above the map content */
      /* Other styling as needed */
      }
      /* Styling for the close button */
      .video-overlay button {
      padding: 10px 20px;
      font-size: 18px;
      font-weight: bold;
      cursor: pointer;
      border: none;
      background-color: #003056;
      color: white;
      border-radius: 30px;
      transition: background-color 0.2s ease;
      margin-top: 40px;
      /* Space between the video and replay button */
      }
      /* Hover effect for the close button */
      .video-overlay button:hover {
      transform: scale(1.02);
      }
      /* Base style for both iframes */
      #youtube-iframe,
      #youtube-iframe-2 {
      max-width: 100%;
      max-height: 100vh;
      border-radius: 30px;
      /* Rounded corners with a radius of 30px */
      }
      /* Media queries to adjust width and height based on screen size for both iframes */
      @media only screen and (min-width: 1025px) {
      #youtube-iframe,
      #youtube-iframe-2 {
      width: 70vw;
      height: calc(70vw * 9 / 16);
      /* Maintain a 16:9 aspect ratio */
      }
      }
      @media only screen and (min-width: 768px) and (max-width: 1024px) {
      #youtube-iframe,
      #youtube-iframe-2 {
      width: 80vw;
      height: calc(80vw * 9 / 16);
      /* Maintain a 16:9 aspect ratio */
      }
      }
      @media only screen and (max-width: 767px) {
      #youtube-iframe,
      #youtube-iframe-2 {
      width: 90vw;
      height: calc(90vw * 9 / 16);
      /* Maintain a 16:9 aspect ratio */
      }
      }
      #video-overlay-2 iframe {
      border-radius: 30px;
      /* Apply a border-radius of 30px */
      }
      @media (max-width: 768px) {
      #counter-pill {
      padding: 8px 15px;
      /* Increased left and right padding */
      font-size: 3vw;
      top: 5.5%;
      max-width: 60%;
      }
      .counter-color {
      height: 12px;
      width: 12px;
      border-radius: 50%;
      display: inline-block;
      margin-right: 1.5px;
      /* Reduced space after the circle */
      margin-left: 1.5px;
      /* Reduced space after the circle */
      }
      #color-counters,
      #category-counters {
      display: flex;
      padding: 0;
      margin: 0;
      gap: 5px;
      }
      #color-counters li,
      #category-counters li {
      flex-grow: 1;
      /* Allow each item to grow to fill available space */
      flex-shrink: 1;
      /* Allow each item to shrink if needed */
      display: flex;
      /* Make the list items flex containers */
      justify-content: center;
      /* Center the content horizontally */
      align-items: center;
      /* Center the content vertically */
      max-height: 100%;
      /* Ensure items do not exceed the pill's height */
      }
      /* Adjust the size of the content (icons, text, etc.) inside the list items */
      #color-counters li>*,
      #category-counters li>* {
      max-height: 50%;
      /* Ensure content does not exceed the list item's height */
      max-width: 50%;
      /* Ensure content does not exceed the list item's width */
      font-size: 2.5vw;
      /* Responsive font size for the content */
      }
      }
      /* Media query for tablet devices */
      @media (min-width: 768px) and (max-width: 1080px) {
      #map {
      left: 15px;
      /* Consistent margin from the left */
      right: calc(40% + 0px);
      /* Adjusting for sidebar width and right margin */
      top: 95px;
      /* Increased from 15px to 95px to accommodate the top bar's height */
      bottom: 15px;
      /* Consistent margin from the bottom */
      border-radius: 30px;
      /* Maintain border radius */
      }
      .counter-color,
      .marker-btn {
      height: 25px;
      /* Adjusted to match desktop version */
      width: 25px;
      /* Adjusted to match desktop version */
      border-radius: 50%;
      display: inline-block;
      margin-right: 5px;
      /* Consistent space after the circle */
      }
      #sidebar {
      width: calc(40% - 30px);
      /* Sidebar takes up 40% width minus the total horizontal margins */
      right: 15px;
      /* Consistent margin from the right */
      top: 95px;
      /* Increased from 15px to 95px to accommodate the top bar's height */
      bottom: 15px;
      /* Consistent margin from the bottom */
      padding: 10px;
      /* Maintain padding */
      overflow-y: auto;
      /* Enables vertical scrolling */
      border-radius: 30px;
      /* Maintain border radius */
      background: var(--sidebar-bg);
      /* Use variable for background */
      }
      }
      /* Mobile view */
      @media screen and (max-width: 1080px) {
      #search-filter-section {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background-color: rgba(0, 0, 0, 0.8);
      z-index: 100;
      overflow: auto;
      justify-content: center;
      align-items: center;
      padding: 20px;
      box-sizing: border-box;
      }
      .filter-container {
      background: white;
      padding: 20px;
      border-radius: 30px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
      }
      }
      @media only screen and (max-width: 1080px) {
      .key-div {
      display: none !important;
      }
      }
      @media only screen and (max-width: 1080px) {
      .pinlist-div {
      display: none !important;
      }
      }
      img {
      border-radius: 30px;
      }
      .logo {
      max-width: 1000px;
      /* Increase the max-width to make it bigger */
      margin-bottom: 30px;
      }
      img:hover {}
      .form-container {
      margin: 40px auto;
      width: 60%;
      background-color: #fff;
      padding: 40px;
      box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.1);
      border-radius: 30px;
      box-sizing: border-box;
      }
      .input-field {
      margin-bottom: 30px;
      }
      label {
      display: block;
      margin-top: 5px;
      margin-bottom: 5px;
      font-size: 18px;
      color: #333;
      }
      input[type="text"],
      select,
      #description-editor,
      #benefit-editor {
      width: 100%;
      padding: 10px;
      border-radius: 5px;
      border: 1px solid #ccc;
      font-size: 16px;
      color: #333;
      box-sizing: border-box;
      }
      input[type="file"] {
      border: none;
      }
      .button {
      border-radius: 30px;
      padding: 15px;
      background-color: white;
      font-weight: bold;
      color: black;
      border: none;
      cursor: pointer;
      transition: background-color 0.3s ease;
      /* Smooth transition for background color */
      }
      .register-button {
      background-color: #003056;
      /* Example color */
      color: white;
      border: none;
      /* Remove the border */
      outline: none;
      /* Remove the outline */
      box-shadow: none;
      /* Remove any shadow that might appear as an outline */
      border-radius: 30px;
      padding: 5px 10px;
      text-align: center;
      text-decoration: none;
      display: inline-block;
      font-weight: bold;
      font-size: 24px;
      margin: auto;
      margin-top: 0px !important;
      margin-bottom: 0px;
      cursor: pointer;
      width: 60%;
      /* Full width */
      box-sizing: border-box;
      /* Include padding in width */
      }
      .register-button-m {
      background-color: #003056;
      /* Example color */
      color: white;
      border: none;
      /* Remove the border */
      outline: none;
      /* Remove the outline */
      box-shadow: none;
      /* Remove any shadow that might appear as an outline */
      border-radius: 30px;
      padding: 5px 10px;
      text-align: center;
      text-decoration: none;
      display: inline-block;
      font-weight: bold;
      font-size: 24px;
      margin: auto;
      margin-top: 0px !important;
      margin-bottom: 0px;
      cursor: pointer;
      width: 97%;
      box-sizing: border-box;
      /* Include padding in width */
      }
      .register-button-f {
      background-color: #003056;
      /* Example color */
      color: white;
      border: none;
      /* Remove the border */
      outline: none;
      /* Remove the outline */
      box-shadow: none;
      /* Remove any shadow that might appear as an outline */
      border-radius: 30px;
      padding: 5px 10px;
      text-align: center;
      text-decoration: none;
      display: inline-block;
      font-weight: bold;
      font-size: 16px;
      margin: auto;
      margin-top: 0px !important;
      margin-bottom: 20px;
      cursor: pointer;
      width: 97%;
      box-sizing: border-box;
      /* Include padding in width */
      }
      .button-container {
      display: flex;
      justify-content: center;
      /* Center horizontally */
      align-items: center;
      /* Center vertically if needed */
      width: 100%;
      /* Take full width of the parent */
      margin-top: 0px;
      /* Add some space on top */
      }
      .publish-button {
      width: 100%;
      /* Full width */
      padding: 20px 0;
      /* Vertical padding */
      font-size: 20px;
      /* Font size */
      background-color: #2874A6;
      /* Background color */
      color: white;
      /* Text color */
      border-radius: 30px;
      /* Border radius */
      border: none;
      /* No border by default */
      cursor: pointer;
      /* Pointer cursor on hover */
      transition: width transform 0.3s ease;
      /* Smooth transition for transform and border */
      }
      .register-button-m:hover {
      transform: scale(1.005);
      /* Scale up on hover */
      filter: brightness(110%);
      /* Increase brightness by 10% */
      }
      .publish-button:hover {
      transform: scale(1.005);
      /* Scale up on hover */
      border: 2px solid black;
      /* Thin black border on hover */
      }
      .project img {
      max-width: 300px;
      /* Adjust the width as needed */
      max-height: 200px;
      /* Adjust the height as needed */
      height: auto;
      /* Maintain aspect ratio */
      width: auto;
      /* Maintain aspect ratio */
      border-radius: 30px;
      /* Optional: if you want rounded corners */
      }
      .top-bar {
      background-color: #003056;
      /* Background color of the top bar */
      height: 80px;
      /* Height of the top bar */
      width: 100%;
      /* Full width of the screen */
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px 20px;
      /* Add padding to the left and right */
      box-sizing: border-box;
      /* Include padding in width calculation */
      align-items: center;
      /* This ensures vertical alignment */
      z-index: 10000;
      /* Ensures the top bar is above Andere content */
      position: fixed;
      /* Fixed positioning to keep the bar at the top */
      top: 0;
      /* Align to the top */
      left: 0;
      /* Align to the left */
      }
      .top-bar a .logo {
      max-width: auto;
      /* Adjust this value as needed */
      max-height: 80px;
      /* Ensure the logo fits within the bar's height */
      margin: auto;
      }
      /* Styles for buttons inside links in the top bar */
      .top-bar a button {
      transition: width 0.3s ease;
      /* Transition for the transform property */
      border-radius: 30px;
      /* If you want to keep the border-radius */
      /* Add any Andere button-specific styles here */
      }
      /* Hover effect for buttons inside links in the top bar */
      /* Hover effect for links in the top bar */
      .top-bar a:not(:has(button)):hover::after {
      transform: scaleX(1);
      /* Show the underscore on hover */
      transform-origin: left;
      }
      .top-bar a {
      color: white;
      text-decoration: none;
      margin-right: 20px;
      /* Add spacing between links */
      font-size: 18px;
      /* Increase text size */
      font-weight: bold;
      /* Make text bold */
      position: relative;
      transition: color 0.3s ease, text-shadow 0.3s ease;
      /* Transition for color and text shadow */
      }
      /* Exclude the logo link from having the underline effect */
      .top-bar a[href="/"]:hover::after {
      content: none;
      }
      /* Underline effect for links that do not contain the logo */
      .top-bar a:not(:has(> .logo))::after {
      content: "";
      position: absolute;
      left: 0;
      bottom: -3px;
      width: 100%;
      height: 2px;
      background-color: white;
      transform: scaleX(0);
      transform-origin: right;
      transition: transform 0.3s;
      }
      /* Additional styles for .logo to ensure it fits well in the top bar */
      .top-bar a .logo {
      max-width: auto;
      /* Adjust this value as needed */
      max-height: 80px;
      /* Ensure the logo fits within the bar's height */
      margin: auto;
      }
      .top-bar a:hover {
      color: #a8c0ff;
      /* Change color on hover */
      text-shadow: 0px 0px 8px rgba(255, 255, 255, 0.7);
      /* Add text shadow on hover */
      }
      .top-bar a::after {
      content: "";
      position: absolute;
      left: 0;
      bottom: -3px;
      width: 100%;
      height: 2px;
      background-color: white;
      transform: scaleX(0);
      transform-origin: right;
      transition: transform 0.3s;
      }
      /* Hover effect for buttons inside links in the top bar */
      /* Underline effect for links that do not contain buttons */
      .top-bar a:not(:has(> button))::after {
      content: "";
      position: absolute;
      left: 0;
      bottom: -3px;
      width: 100%;
      height: 2px;
      background-color: white;
      transform: scaleX(0);
      transform-origin: right;
      transition: transform 0.3s;
      }
      /* Hover effect to show underline for links that do not contain buttons */
      .top-bar a:not(:has(> button)):hover::after {
      transform: scaleX(1);
      }
      .index-image {
      position: relative;
      /* Change positioning context to relative */
      width: 100%;
      object-fit: cover;
      max-height: 500px;
      border-radius: 0px;
      }
      .index-image:hover {
      transform: scale(1.00);
      /* !important: */
      }
      .cover-text-container {
      position: absolute;
      top: 70%;
      left: 50%;
      transform: translate(-50%, -50%);
      background-color: rgba(0, 0, 0, 0.3);
      /* Black background with 70% opacity */
      padding: 25px;
      border-radius: 80px;
      text-align: center;
      }
      .cover-text-container h1 {
      font-size: 40px;
      color: white;
      margin: 0;
      padding-bottom: 10px;
      text-shadow:
      -2px -2px 0 black,
      2px -2px 0 black,
      -2px 2px 0 black,
      2px 2px 0 black;
      }
      .cover-text-container p {
      font-size: 30px;
      color: white;
      margin: 0;
      text-shadow:
      -2px -2px 0 black,
      2px -2px 0 black,
      -2px 2px 0 black,
      2px 2px 0 black;
      }
      .info-box-container {
      display: flex;
      justify-content: space-evenly;
      padding: 20px;
      }
      .info-box {
      background-color: #1b1b1b;
      border-radius: 30px;
      padding: 20px;
      text-align: center;
      transition: width 0.3s ease;
      width: 30%;
      /* Set a fixed width for each box */
      }
      .info-box:hover {
      transform: scale(1.005);
      }
      .info-box-icon {
      max-width: 70px;
      /* Icon size */
      border-radius: 50%;
      /* Make it circular */
      }
      .info-box-title {
      color: white;
      font-size: 30px;
      margin: 10px 0;
      }
      .info-box-undertitle {
      color: white;
      font-size: 16px;
      }
      /* Specific colors for each box */
      .box-red {
      background-color: #06467c;
      }
      .box-blue {
      background-color: #02569d;
      }
      .box-green {
      background-color: #2874A6;
      }
      .info-text-field {
      background-color: #F4F4F8;
      /* Light grey background */
      width: 100%;
      /* Full width */
      height: 400px;
      /* Specified height */
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
      padding: 20px;
      box-sizing: border-box;
      /* Include padding in width calculation */
      }
      .info-text-container {
      width: 50%;
      /* Width of the text container */
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
      }
      .info-text-title {
      font-size: 30px;
      color: black;
      margin-bottom: 10px;
      }
      .info-text-undertitle {
      font-size: 20px;
      color: black;
      margin-top: 10px;
      }
      input[type="text"],
      select,
      #description-editor,
      #benefit-editor {
      margin-bottom: 0px !important;
      }
      /* Media Query for Desktop Sizes Between 768px and 1445px */
      @media (min-width: 768px) and (max-width: 1445px) {
      .markers-sidebar {
      width: 35%;
      /* Adjusted width to 35% */
      }
      }
      @media only screen and (max-width: 1445px) {
      .top-bar a button {
      transition: width 0.3s ease;
      /* Transition for the transform property */
      border-radius: 30px;
      /* If you want to keep the border-radius */
      padding: 7px;
      /* Add any Andere button-specific styles here */
      }
      }
      #hamburger-button {
      display: none;
      /* Hidden by default */
      }
      @media only screen and (max-width: 1080px) {
      body {
      font-size: 14px;
      /* Smaller font size */
      }
      #hamburger-button {
      display: none;
      /* Hidden by default */
      font-size: 30px;
      /* Icon size */
      color: white;
      /* Icon color */
      background: none;
      /* No background */
      border: none;
      /* No border */
      cursor: pointer;
      /* Pointer cursor */
      }
      .top-bar {
      flex-direction: column;
      /* Stack items vertically */
      height: auto;
      /* Adjust height automatically */
      }
      .form-container {
      width: 90%;
      /* Full width with some margin */
      padding: 20px;
      /* Smaller padding */
      }
      .publish-button {
      font-size: 18px;
      /* Slightly smaller font size */
      padding: 15px 0;
      /* Adjust padding */
      }
      /* Hamburger Menu Button */
      /* Navigation Overlay */
      .nav-overlay {
      display: none;
      /* Hidden by default */
      position: fixed;
      /* Fixed position */
      width: 100%;
      /* Full width */
      height: 100%;
      /* Full height */
      top: 0;
      left: 0;
      background-color: rgba(0, 0, 0, 0.9);
      /* Semi-transparent black */
      overflow-x: hidden;
      /* Hide horizontal overflow */
      transition: 0.5s;
      /* Smooth transition for opening/closing */
      z-index: 10001 !important;
      /* High z-index to ensure it's on top */
      }
      .nav-overlay-active .main-content {
      pointer-events: none;
      }
      }
      /* Mobile Devices */
      @media only screen and (max-width: 1080px) {
      label {
      display: block;
      font-size: 16px;
      color: #333;
      }
      .register-button-m {
      width: calc(100% - 10px);
      /* Full width minus the left and right margins */
      margin-left: 5px;
      /* 5px gap on the left */
      margin-right: 5px;
      /* 5px gap on the right */
      display: block;
      /* Change display to block for full width */
      font-size: 16px !important;
      }
      .button-container {
      padding: 0;
      /* Remove padding if any */
      }
      .top-bar a .logo {
      margin-left: auto;
      /* Adjust logo position */
      margin-right: auto;
      }
      #nav-links {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100%;
      }
      #nav-links a {
      padding: 20px;
      /* Larger clickable area */
      font-size: 24px;
      /* Larger font size */
      }
      }
      /* Mobile Devices */
      @media only screen and (max-width: 1080px) {
      .top-bar {
      flex-direction: row;
      /* Align items horizontally */
      justify-content: space-between;
      /* Space between items */
      align-items: center;
      /* Vertically center items */
      padding: 10px 15px;
      /* Consistent padding */
      }
      .top-bar a {
      display: flex;
      /* Flex container for the logo */
      align-items: center;
      /* Vertically center logo */
      margin: 0;
      /* Remove any default margin */
      }
      .top-bar a .logo {
      max-width: 270px;
      /* Adjust logo size */
      max-height: 350px;
      /* Adjust height automatically */
      }
      #hamburger-button {
      display: block;
      /* Show the button on mobile */
      margin: 0;
      /* Remove any margin */
      align-self: center;
      /* Explicitly center the button vertically */
      }
      #nav-links {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100%;
      #nav-links a {
      padding: 20px;
      /* Padding for each link */
      font-size: 24px;
      /* Font size for links */
      }
      }
      @media only screen and (max-width: 768px) {
      .info-box-container {
      flex-direction: column;
      align-items: center;
      }
      .info-box {
      width: 80%;
      /* Adjust width to fit mobile screens */
      margin-bottom: 20px;
      /* Add some space between the boxes */
      }
      }
      @media only screen and (max-width: 1080px) {
      .cover-text-container h1 {
      font-size: 4vw;
      /* Adjust font size for smaller screens */
      }
      .cover-text-container p {
      font-size: 3.5vw;
      /* Larger size for smaller screens */
      }
      .cover-text-container {
      background-color: rgba(0, 0, 0, 0.0) !important;
      /* Black background with 70% opacity */
      top: 60%;
      width: 90%;
      /* Set the width to 90% of the parent container */
      }
      }
      .cover-text-container {
      background-color: rgba(0, 0, 0, 0.4);
      /* Black background with 70% opacity */
      top: 50%;
      width: 90%;
      /* Set the width to 90% of the parent container */
      }
      }
      .info-text-title,
      .info-text-undertitle {
      font-size: 2.5vw;
      /* Adjust as needed */
      }
      @media only screen and (max-width: 1080px) {
      .info-text-title {
      font-size: 4vw;
      /* Larger size for smaller screens */
      }
      .info-text-undertitle {
      font-size: 3vw;
      /* Larger size for smaller screens */
      }
      }
      @media only screen and (max-width: 1080px) {
      .info-text-field {
      height: auto;
      /* Allow the height to adjust based on content */
      }
      .info-text-container {
      width: 80%;
      /* Reduce the width for tablets */
      }
      }
      @media only screen and (max-width: 768px) {
      .info-text-field {
      height: auto;
      /* Allow the height to adjust based on content */
      }
      .info-text-container {
      width: 90%;
      /* Reduce the width further for mobile */
      }
      }
   </style>
   <style>
      /* Scale logo image on hover */
      img.logo:hover {
      transform: scale(1.005);
      transition: width 0.3s ease;
      }
      /* Hover effect for category buttons (dynamically generated) */
      #category-toggle-buttons button:hover {
      transform: scale(1.005);
      }
      /* Scale register buttons on hover */
      .register-button:hover {
      transform: scale(1.005);
      transition: width 0.3s ease;
      }
      .register-button-f:hover {
      transform: scale(1.005);
      transition: width 0.3s ease;
      }
   </style>
   <body>
      <!-- Video Overlay -->
      <div id="video-overlay" class="video-overlay" style="display:none;">
         <iframe id="youtube-iframe" width="560" height="315" src="https://www.youtube.com/embed/9-bWivUusZ4" frameborder="0" allowfullscreen></iframe>
         <div id="replay-container" style="display: none;"></div>
         <!-- Container for replay image -->
         <button onclick="closeVideoOverlay()">Schließen</button>
      </div>
      <!-- Video Overlay 2 -->
      <div id="video-overlay-2" class="video-overlay" style="display:none;">
         <iframe id="youtube-iframe-2" width="560" height="315" src="https://www.youtube.com/embed/aoqu_9iibPo" frameborder="0" allowfullscreen></iframe>
         <div id="replay-container-2" style="display: none;"></div>
         <!-- Container for replay image -->
         <button onclick="closeVideoOverlay2()">Schließen</button>
      </div>
      <div class="top-bar">
         <a href="/">
         <img src="{{ url_for('serve_image', filename='logo.png') }}" alt="Logo" class="logo">
         </a>
         <button id="hamburger-button">&#9776;</button>
         <div id="nav-overlay" class="nav-overlay" style="z-index: 10001 !important;">
            <div id="nav-links">
               <a href="/karte">Karte</a>
               <a href="/list">Projektvorschläge</a>
               <a href="/neuerbeitrag">Vorschlag hinzufügen</a>
               <a href="/ueber">Über</a>
               <a href="/profil">Profil</a> {% if current_user.is_authenticated %} <span class="user-info" style="margin-top: 10px;"> Benutzer: {{ current_user.name }}
               </span>
               <a href="{{ url_for('logout', next=request.path) }}">
               <button class="overlay-button">Abmelden</button>
               </a> {% else %} <a href="{{ url_for('login', next=request.path) }}">
               <button class="overlay-button">Anmelden</button>
               </a> {% endif %}
            </div>
         </div>
      </div>
      <!-- Custom Confirmation Dialog -->
      <div id="custom-confirm" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.0); z-index: 10000; text-align: center;">
         <div id="mobile-confirm" class="mobile-confirm">
            <p class="p-mobile-confirm">Möchten Sie die Notiz hier platzieren?</p>
            <button id="confirm-yes" class="register-button-c" style="background-color: #0e3a3a !important;">Ja</button>
            <button id="confirm-tryagain" class="register-button-c" style="background-color: #ffa500 !important; margin-top: 10px !important;">Erneut versuchen</button>
            <button id="confirm-no" class="register-button-c" style="background-color: #de3a3a !important; margin-top: 10px !important;">Stornieren</button>
         </div>
      </div>
      <!-- Overlay for displaying the list of markers -->
      <div id="markers-list-overlay" class="markers-sidebar">
         <div class="scrollable-content">
            <!-- All your filters and the list go here -->
            <div id="category-filter"></div>
            <div id="sort-filter"></div>
            <div id="full-project-filter"></div>
            <ul id="markers-list" style="margin-bottom:20px;">
               <!-- Marker items will be added here dynamically -->
            </ul>
            <button id="show-more-markers" onclick="loadMoreMarkers()" style="display: none;">Mehr anzeigen</button>
         </div>
         <button onclick="document.getElementById('markers-list-overlay').style.display='none'" id="close-overlay-button" class="register-button-f" style="margin-top: 10px !important;">Schließen</button>
      </div>
      <!-- Marker Placing Overlay -->
      <div id="marker-overlay">
         <div id="overlay-content">
            <div class="title-button-container">
               <h2 class="title-imagebutton" style="font-size: 21px;">Notiz hinzufügen</h2>
               <a href="#" id="info-link">
               <img src="{{ url_for('serve_image', filename='infobutton.png') }}" alt="Info" class="info-image">
               </a>
            </div>
            <h3 style="font-size: 16px;">
               <a href="/neuerbeitrag" style="color: #003056; text-decoration: underline;">Hier klicken, um Projektvorschläge zu posten.</a>
            </h3>
            <!-- Wrapper div for the select and the textarea -->
            <div style="width: 100%; box-sizing: border-box; text-align: center;">
               <h2 style="font-size: 21px;">1. Kategorie auswählen:</h2>
               <select id="marker-category" onchange="updateMarkerCategoryDescription()" style="width: 100%; box-sizing: border-box; text-align: center; border: 1px solid black;">
                  <option value="Transport">Transport</option>
                  <option value="Öffentliche Plätze">Öffentliche Plätze</option>
                  <option value="Umwelt">Umwelt</option>
                  <option value="Verwaltung">Verwaltung</option>
                  <option value="Kultur">Kultur</option>
                  <option value="Bildung">Bildung</option>
                  <option value="Gesundheit">Gesundheit</option>
                  <option value="Sport">Sport</option>
                  <option value="Andere">Andere</option>
               </select>
               <br>
               <br>
               <h2 style="font-size: 21px;">Die ausgewählte Kategorie betrifft Themen wie:</h2>
               <h3 id="marker-category-description" style="color:#003056; font-size: 16px;"></h3>
               <!-- Description will appear here -->
               <h2>2. Beschreiben Sie die Umstände:</h2>
               <textarea id="marker-description" rows="7" style="width: 100%; box-sizing: border-box; text-align: left; border: 1px solid black; font-size: 16px; font-family: 'Roboto', sans-serif;" placeholder="Was beschäftigt Sie?"></textarea>
            </div>
            <br>
            <h3 style="font-size: 16px" id="limit-info">limit info here</h3>
            <div class="button-container">
               <button id="add-marker-button" onclick="postMarker()" class="register-button">Hinzufügen</button>
            </div>
         </div>
      </div>
      <div>
         <div id="mobileCategoryOverlay"></div>
         <div id="sidebar-mobileheader" style="display: none;">
            <h3 class="appear-on-mobiledisabled resistant-h3" style="display: none; color: white; text-align: center; margin-top: 5px;"> Wie stehen Sie zu den Orten in Ihrer Gemeinde? </h3>
            <h3 class="appear-on-mobiledisabled resistant-h3" style="display: none; color: white; text-align: center; margin-top: -12px; margin-bottom: 7px"> Lassen Sie es uns auf dieser Karte wissen! </h3>
         </div>
         <div id="map">
            <a href="#" id="info-link2">
            <img src="{{ url_for('serve_image', filename='infobutton2.png') }}" alt="Info" class="info-image2" style="z-index: 1002 !important;">
            </a>
            <!-- Inside the map div -->
         </div>
         <?php MAP END ?> <?php SIDEBAR BODY START ?> 
         <div id="sidebar">
            <h3 class="hide-on-mobile resistant-h3" style="display: none; text-align: center; margin-top: 5px;"> Wie stehen Sie zu den Orten in Ihrer Gemeinde? </h3>
            <h3 class="hide-on-mobile resistant-h3" style="display: none; text-align: center; margin-top: -12px; margin-bottom: 7px"> Lassen Sie es uns auf dieser Karte wissen! </h3>
            <?php WEBSITE DESCRIPTION END ?>
            <!-- SMALL OPTIONS MENU TOP START -->
            <div class="smalloptionsmenutop" style="display: flex; align-items: center; justify-content: center;">
               <div class="left-container">
                  <!-- This button shows the user a list of existing pins -->
               </div>
               <div class="button-s" id="buttonS" onclick="addAndRemoveClass()" style="width: auto; height: auto; padding: 15px; display:none;">
                  <h3> Wie funktioniert's? </h3>
               </div>
            </div>
            <?php CITY LOGO START ?> <img class="hide-on-mobile resistant-image" id="overlay-image" src="static/overlay.jpg" style="max-width: 97%; height: auto; display: block; margin-left:auto; margin-right:auto; margin-top: 3px; margin-bottom: 20px; border-radius: 30px; max-height: 368px;" /> <?php CITY LOGO END ?> 
            <div class="button-container">
               <button id="open-overlay" class="register-button-m" onclick="openMarkerOverlay(event)" style="margin-bottom: 10px">Hinzufügen</button>
            </div>
            <div class="button-container">
               <button id="show-markers-btn" class="register-button-m">Liste anzeigen</button>
            </div>
            <div class="button-container">
               <button id="hideNonMapMarkers" class="register-button-m" style="margin-bottom: 10px; margin-top: 10px !important;">Nur Projektvorschläge anzeigen</button>
            </div>
            <h3 style="display: block; text-align: center; margin-top: 5px;"> Klicken Sie zum ein- und ausblenden. </h3>
            <div id="category-toggle-buttons">
               <!-- Buttons will be added here dynamically -->
            </div>
         </div>
         <?php CATEGORIES PULL END ?>
      </div>
      <?php SIDEBAR BODY END ?>
      <script type="text/javascript">
         if (typeof isSpam === 'undefined') {
          window.isSpam = function() { return false; };
         }
         
         
         var swearWords = {
          "de": [],
          "en": []
         };
         
         // Function to load swear words from filter.json
         function loadSwearWords() {
          fetch('/static/filter.json').then(response => response.json()).then(data => {
            swearWords = data;
          }).catch(error => {});
         }
         
         // Call this function when the page loads
         loadSwearWords();
         
         
           var userLoggedIn = {{ 'true' if current_user.is_authenticated else 'false' }};
              // Initialize the map
              var map = L.map('map').setView([48.4102, 15.6022], 15);
              var currentDrawnLayer = null;
              var selectedToolButton = null;
              // Track the current base layer
              var currentBaseLayer = 'Standardkarte'; // Default layer
              // Calculate the offset for boundaries
              var horizontalOffset = 1125; // 1.0225 km on each side, total 2.25 km
              var verticalOffset = 594; // 0.59375 km on each side, total 1.02875 km
              // Define the boundaries
              var centerPoint = map.project([48.4102, 15.6022], map.getZoom());
              var southWest = map.unproject(centerPoint.subtract([horizontalOffset, verticalOffset]), map.getZoom());
              var northEast = map.unproject(centerPoint.add([horizontalOffset, verticalOffset]), map.getZoom());
              var bounds = L.latLngBounds(southWest, northEast);
              // Calculate extended bounds for 10 km buffer
              var extendedHorizontalOffset = horizontalOffset + 1000; // Add 10 km
              var extendedVerticalOffset = verticalOffset + 1000; // Add 10 km
              var extendedSouthWest = map.unproject(centerPoint.subtract([extendedHorizontalOffset, extendedVerticalOffset]), map.getZoom());
              var extendedNorthEast = map.unproject(centerPoint.add([extendedHorizontalOffset, extendedVerticalOffset]), map.getZoom());
              var extendedBounds = L.latLngBounds(extendedSouthWest, extendedNorthEast);
              // Set the max bounds to restrict dragging beyond 10 km from the original boundary
              map.setMaxBounds(extendedBounds);
              // Debugging: Log when the user reaches the edge of the draggable area
              map.on('drag', function() {
                if (!extendedBounds.contains(map.getCenter())) {
                }
              });
              // Define the coordinates for a very large outer rectangle
              var outerBounds = [
                L.latLng(-90, -180),
                L.latLng(90, -180),
                L.latLng(90, 180),
                L.latLng(-90, 180),
                L.latLng(-90, -180)
              ];
              // Define the coordinates for the inner rectangle (the boundary)
              var innerBounds = [
                bounds.getSouthWest(),
                bounds.getNorthWest(),
                bounds.getNorthEast(),
                bounds.getSouthEast(),
                bounds.getSouthWest()
              ];
              var boundary = L.latLngBounds(innerBounds);
              // Create a polygon with a hole (inverted polygon)
              var invertedPolygon = L.polygon([outerBounds, innerBounds], {
                color: 'grey',
                fillColor: 'grey',
                fillOpacity: 0.5
              }).addTo(map);
              // Draw the boundary rectangle
              L.rectangle(bounds, {
                color: "#808080",
                weight: 2,
                fill: false
              }).addTo(map);
              L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                minZoom: 15,
                attribution: '| © OpenStreetMap contributors'
              }).addTo(map);
              // Map layers
              var osmLayer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                minZoom: 15,
                attribution: '....'
              });
              var satelliteLayer = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
                minZoom: 15,
                attribution: '&copy; Esri &mdash; Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, GIS User Community'
              });
              var thunderforestLayers = {
                "Atlas": L.tileLayer('https://tile.thunderforest.com/atlas/{z}/{x}/{y}.png?apikey=5c57f95ca93348f1a37f6572742a5b48', {
                  minZoom: 15,
                  attribution: 'Tiles © Thunderforest, ....'
                }),
                "Neighbourhood": L.tileLayer('https://tile.thunderforest.com/neighbourhood/{z}/{x}/{y}.png?apikey=5c57f95ca93348f1a37f6572742a5b48', {
                  minZoom: 15,
                  attribution: 'Tiles © Thunderforest, ....'
                }),
                "Transport": L.tileLayer('https://tile.thunderforest.com/transport/{z}/{x}/{y}.png?apikey=5c57f95ca93348f1a37f6572742a5b48', {
                  minZoom: 15,
                  attribution: 'Tiles © Thunderforest, ....'
                }),
                "Cycle": L.tileLayer('https://tile.thunderforest.com/cycle/{z}/{x}/{y}.png?apikey=5c57f95ca93348f1a37f6572742a5b48', {
                  minZoom: 15,
                  attribution: 'Tiles © Thunderforest, ....'
                }),
                "Mobile_Atlas": L.tileLayer('https://tile.thunderforest.com/mobile-atlas/{z}/{x}/{y}.png?apikey=5c57f95ca93348f1a37f6572742a5b48', {
                  minZoom: 15,
                  attribution: 'Tiles © Thunderforest, ....'
                }),
                "Pioneer": L.tileLayer('https://tile.thunderforest.com/pioneer/{z}/{x}/{y}.png?apikey=5c57f95ca93348f1a37f6572742a5b48', {
                  minZoom: 15,
                  attribution: 'Tiles © Thunderforest, ....'
                }),
              };
              // basemap.at layers
              var basemapLayers = {
                "GeolandBasemap": L.tileLayer('http://maps.wien.gv.at/basemap/geolandbasemap/normal/google3857/{z}/{y}/{x}.png', {
                  minZoom: 15,
                  attribution: 'Basemap.at, ....'
                }),
                "BmapGrau": L.tileLayer('http://maps.wien.gv.at/basemap/bmapgrau/normal/google3857/{z}/{y}/{x}.png', {
                  minZoom: 15,
                  attribution: 'Basemap.at, ....'
                })
              };
              var baseLayers = {
                "Standardkarte": osmLayer,
                "Satellit": satelliteLayer,
                "Klar": thunderforestLayers.Atlas,
                "Öffi": thunderforestLayers.Transport,
                "Radwege": thunderforestLayers.Cycle,
                "Grau": basemapLayers.BmapGrau,
                "Kontrast": thunderforestLayers.Mobile_Atlas,
                "Papyrus": thunderforestLayers.Pioneer,
              };
              // Add default layer to map
              baseLayers["Standardkarte"].addTo(map);
              map.on('baselayerchange', function(e) {
                currentBaseLayer = e.name;
                updateMarkerIcons();
              });
              L.control.layers(baseLayers).addTo(map);
              // Global variable to store the future marker icon and details
              let futureMarker = {
                icon: null,
                category: '',
                description: ''
              };
              // Function to create a colored circle icon
              function createIcon(pinSize, outlineSize, fillColor, isFeatured) {
                var adjustedPinSize = currentBaseLayer === 'Satellit' ? pinSize * 2.5 : pinSize * 1.5;
                var strokeColor = currentBaseLayer === 'Satellit' ? 'white' : fillColor;
                var strokeWidth = currentBaseLayer === 'Satellit' ? 5 : outlineSize * 10;
                var strokeOpacity = currentBaseLayer === 'Satellit' ? 1 : 0.5;
                // Star emoji
                var starSize = adjustedPinSize / 2; // Star emoji size
                var starEmoji = isFeatured ? `
         											<text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" font-size="${starSize}" fill="yellow">⭐</text>` : '';
                // Black outline for featured project
                var blackOutline = isFeatured ? `
         											<circle cx="${adjustedPinSize / 2}" cy="${adjustedPinSize / 2}" r="${adjustedPinSize / 4 + 2}" stroke="black" stroke-width="2" fill="none" />` : '';
                // SVG icon with conditional star and outline
                var svgIcon = `
         											<svg
         												xmlns="http://www.w3.org/2000/svg" width="${adjustedPinSize}" height="${adjustedPinSize}" viewBox="0 0 ${adjustedPinSize} ${adjustedPinSize}">
         												<circle cx="${adjustedPinSize / 2}" cy="${adjustedPinSize / 2}" r="${adjustedPinSize / 4}" fill="${fillColor}" />
         												<circle cx="${adjustedPinSize / 2}" cy="${adjustedPinSize / 2}" r="${adjustedPinSize / 4}" stroke="${strokeColor}" stroke-width="${strokeWidth}" fill="none" stroke-opacity="${strokeOpacity}" />
                ${blackOutline}
                ${starEmoji}
            
         											</svg>`;
                return L.icon({
                  iconUrl: `data:image/svg+xml;base64,${btoa(unescape(encodeURIComponent(svgIcon)))}`,
                  iconSize: [adjustedPinSize, adjustedPinSize],
                  iconAnchor: [adjustedPinSize / 2, adjustedPinSize / 2],
                  popupAnchor: [0, -adjustedPinSize / 2]
                });
              }
              // Function to create a simple SVG icon for cursor
              function createCursorIcon(fillColor) {
                var svgCursorIcon = `
         											<svg
         												xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
         												<circle cx="12" cy="12" r="10" fill="${fillColor}" />
         											</svg>`;
                return `data:image/svg+xml;base64,${btoa(unescape(encodeURIComponent(svgCursorIcon)))}`;
              }
              var isMarkerCreationActive = false;
              // Function to set the map cursor and activate marker creation process
              function setMapCursor() {
                var cursorIconUrl = futureMarker.icon;
                document.getElementById('map').style.cursor = `url('${cursorIconUrl}') 12 12, auto`;
                isMarkerCreationActive = true; // Activate marker creation process
              }
              // Function to handle map click for placing a marker
              function handleMapClick(e) {
                // Only process click if marker creation is active
                if (isMarkerCreationActive) {
                  // Check if the clicked location is inside the boundary
                  if (boundary.contains(e.latlng)) {
                    selectedLatLng = e.latlng;
                    var tempMarker = L.marker(e.latlng, {
                      icon: createIcon(24, 2, getCategoryColor(futureMarker.category))
                    }).addTo(map);
                    showCustomConfirm(selectedLatLng, tempMarker);
                  } else {
                  }
                }
              }
              // Register the map click event listener
              map.on('click', handleMapClick);
              // Function to show the custom confirmation dialog
              function showCustomConfirm(latlng, tempMarker) {
                var confirmDiv = document.getElementById('custom-confirm');
                confirmDiv.style.display = 'block';
                document.getElementById('confirm-yes').onclick = function() {
                  saveMarkerData(latlng, futureMarker.category, futureMarker.description, function(savedMarkerData) {
                    map.removeLayer(tempMarker); // Remove the temporary marker
                    addNewMarker(latlng, futureMarker.category, futureMarker.description, savedMarkerData.id);
                  });
                  confirmDiv.style.display = 'none';
                  resetMapCursor();
                  isMarkerCreationActive = false;
                };
                document.getElementById('confirm-tryagain').onclick = function() {
                  map.removeLayer(tempMarker); // Remove the temporary marker
                  confirmDiv.style.display = 'none';
                  isMarkerCreationActive = true; // Reactivate marker creation process
                  setMapCursor(); // Reset cursor to marker icon
                };
                document.getElementById('confirm-no').onclick = function() {
                  map.removeLayer(tempMarker); // Remove the temporary marker
                  confirmDiv.style.display = 'none';
                  resetMapCursor();
                  isMarkerCreationActive = false; // Deactivate marker creation process
                };
         
                function addNewMarker(latLng, category, description, markerId) {
                  var fillColor = getCategoryColor(category);
                  var popupContent = `
         											<div style="text-align: center;">${description}</div>`;
                  var marker = L.marker(latLng, {
                    icon: createIcon(24, 2, fillColor, false), // Assuming the new marker is not featured
                    category: category,
                    isMapObject: true,
                    isFeatured: false
                  }).addTo(map);
                  marker.bindPopup(popupContent);
                  // Attach the markerId to the marker
                  marker.markerId = markerId;
                  // Add the new marker to the corresponding category layer
                  if (!categoryLayers[category]) {
                    categoryLayers[category] = L.layerGroup().addTo(map);
                  }
                  marker.addTo(categoryLayers[category]);
                  // Update button text for the category
                  updateCategoryButtonText(category);
                }
         
                function updateCategoryButtonText(category) {
                  var button = document.querySelector(`button[category-name="${category}"]`);
                  if (button && categoryLayers[category]) {
                    button.innerText = `${category} (${categoryLayers[category].getLayers().length} Beiträge)`;
                  }
                }
                document.getElementById('confirm-tryagain').onclick = function() {
                  map.removeLayer(tempMarker); // Remove the temporary marker
                  confirmDiv.style.display = 'none';
                  isMarkerCreationActive = true; // Reactivate marker creation process
                  setMapCursor(); // Reset cursor to marker icon
                };
                document.getElementById('confirm-no').onclick = function() {
                  map.removeLayer(tempMarker);
                  confirmDiv.style.display = 'none';
                  resetMapCursor();
                  isMarkerCreationActive = false; // Deactivate marker creation process
                };
              }
              // Function to reset map cursor
              function resetMapCursor() {
                document.getElementById('map').style.cursor = '';
                isMarkerCreationActive = false; // Deactivate marker creation process
              }
              // Function to open marker overlay
              function openMarkerOverlay(event) {
                var overlay = document.getElementById('marker-overlay');
                if (overlay) {
                  overlay.style.display = 'flex'; // Force display flex
                  overlay.style.justifyContent = 'center';
                  overlay.style.alignItems = 'center';
                  overlay.style.zIndex = '10000'; // Ensure it's above other content
                  // Update the category description when the overlay is opened
                  updateMarkerCategoryDescription();
                } else {
                }
                // Stop propagation if it's a user-triggered event
                if (event) {
                  event.stopPropagation();
                }
              }
              // Function to initialize event listeners
              function initializeEventListeners() {
                // Attach a click event listener to the "marker-description" text area
                document.getElementById('marker-description').addEventListener('click', function() {
                });
              }
              // Call the function to initialize the event listeners
              initializeEventListeners();
         
              function updateMarkerCategoryDescription() {
                const categorySelect = document.getElementById("marker-category");
                const categoryDescription = document.getElementById("marker-category-description");
                const selectedOption = categorySelect.value;
                let categoryText = "";
                switch (selectedOption) {
                  case "Transport":
                    categoryText = "Wünschen Sie sich einen neuen Radweg? Eine neue Busverbindung? Gibt es Probleme mit dem Parken?";
                    break;
                  case "Öffentliche Plätze":
                    categoryText = "Sollen öffentliche Plätze umgestaltet werden? Braucht es mehr Grünflächen?";
                    break;
                  case "Umwelt":
                    categoryText = "Ist Ihnen Umweltverschmutzung aufgefallen? Haben Sie Ideen, um die Stadt sauberer, ökologischer oder Zukunftsfit zu machen?";
                    break;
                  case "Verwaltung":
                    categoryText = "Gibt es Ideen für bessere Dienste der Verwaltung? Projektvorschläge, öffentliche Veranstaltungen betreffen?";
                    break;
                  case "Kultur":
                    categoryText = "Gibt es Ideen für Veranstaltungen, Kunstinstallationen, Theater oder Literatur?";
                    break;
                  case "Bildung":
                    categoryText = "Welche Dinge im Bereich der Bildung, Schulen und Hochschulen können wir als Gemeinde verbessern?";
                    break;
                  case "Gesundheit":
                    categoryText = "Ideen zum Thema Gesundheit? Verbesserungsvorschläge für medizinische Einrichtungen oder gesundheitsfördernde Maßnahmen?";
                    break;
                  case "Sport":
                    categoryText = "Ideen zu Sportveranstaltungen, Sportplätzen oder städtischen Kursen?";
                    break;
                  case "Andere":
                    categoryText = "Haben Sie einen eigenen Vorschlag, der in keine der genannten Kategorien passt? Teilen Sie Ihre Idee uns mit!";
                    break;
                  default:
                    categoryText = "Bitte wählen Sie eine Kategorie aus.";
                    break;
                }
                categoryDescription.textContent = categoryText;
              }
              var swearWords = {
                "de": [],
                "en": []
              };
              // Function to load swear words from filter.json
              function loadSwearWords() {
                fetch('/static/filter.json').then(response => response.json()).then(data => {
                  swearWords = data;
                }).catch(error => {});
              }
              // Call this function when the page loads
              loadSwearWords();
              // Function to check for swear words in a given text
              function containsSwearWords(text, language) {
                var words = swearWords[language] || [];
                var textWords = text.toLowerCase().split(/\s+/);
                return textWords.some(word => words.includes(word));
              }
              // Function to handle posting a marker
              // Function to handle posting a marker
              function postMarker() {
                // Get the textarea and its value
                var markerDescriptionTextarea = document.getElementById('marker-description');
          var description = markerDescriptionTextarea.value;
         
          if (containsSwearWords(description, 'de') || containsSwearWords(description, 'en')) {
            alert("Bitte entfernen Sie unangebrachte Ausdrücke aus Ihrer Beschreibung.");
            return; // Stop the function here if swear words are found
          }
          if (isSpam(description)) {
            alert("Ihr Text scheint Spam zu enthalten. Bitte überprüfen Sie ihn und versuchen Sie es erneut.");
            return;
          }
                // Check if the description meets the minimum character requirement
                if (description.length < 15) {
                  alert("Bitte geben Sie mindestens 15 Zeichen ein.");
                  return; // Stop the function if the condition is not met
                }
                // Continue with the rest of your function if the condition is met
                var markerOverlay = document.getElementById('marker-overlay');
                if (markerOverlay) {
                  markerOverlay.style.display = 'none';
                } else {
                  return;
                }
                // Get the selected category from the form
                var selectedCategory = document.getElementById('marker-category').value;
                // Prepare the future marker details
                futureMarker.category = selectedCategory;
                futureMarker.description = description;
                var fillColor = getCategoryColor(selectedCategory);
                futureMarker.icon = createCursorIcon(fillColor);
                // Change the cursor to the future marker icon
                setMapCursor();
                // Clear the textarea
                document.getElementById('marker-description').value = '';
              }
              // Function to toggle the sidebar visibility and adjust map size
              function toggleMarkerSidebar() {
                var sidebar = document.getElementById('sidebar');
                var mapElement = document.getElementById('map');
                if (sidebar.style.display === 'none' || sidebar.style.display === '') {
                  sidebar.style.display = 'block';
                  mapElement.classList.add('sidebar-visible'); // Add class to resize map
                } else {
                  sidebar.style.display = 'none';
                  mapElement.classList.remove('sidebar-visible'); // Remove class to resize map
                }
              }
              var allMarkers = []; // Store all markers
              var displayedMarkersCount = 0;
              const markersPerPage = 20; // Number of markers per page
              const categoryColors = {
                'Transport': '#133873',
                'Öffentliche Plätze': '#ff5c00',
                'Umwelt': '#4CAF50',
                'Verwaltung': '#653993',
                'Kultur': '#431307',
                'Bildung': '#eab003',
                'Gesundheit': '#9A031E',
                'Sport': '#3d4f53',
                'Andere': '#212121'
              };
         
              function addMarkersToOverlay(markers) {
                allMarkers = markers; // Store all markers
                displayedMarkersCount = 0; // Reset displayed markers count
                loadMoreMarkers(); // Load initial set of markers
                const sortedMarkers = sortMarkersByNewest(markers);
                let currentPage = 1; // Start with the first page
                let filteredMarkers = markers.slice().sort((a, b) => b.id - a.id); // Default to Sortieren by newest
                let showFullProjectsOnly = false;
                const categoryColors = {
                  'Transport': '#133873',
                  'Öffentliche Plätze': '#ff5c00',
                  'Umwelt': '#4CAF50',
                  'Verwaltung': '#653993',
                  'Kultur': '#431307',
                  'Bildung': '#eab003',
                  'Gesundheit': '#9A031E',
                  'Sport': '#3d4f53',
                  'Andere': '#212121'
                };
         
                function filterByCategory(category) {
                  let tempMarkers = markers;
                  if (category !== "Alle") {
                    tempMarkers = tempMarkers.filter(marker => marker.category === category);
                  }
                  if (showFullProjectsOnly) {
                    tempMarkers = tempMarkers.filter(marker => !marker.is_mapobject);
                  }
                  filteredMarkers = tempMarkers.slice().sort((a, b) => b.id - a.id); // Sortieren by Sortieren by newest
                  renderPage(1); // Reset to the first page after filtering
                }
         
                function sortMarkers(sortType) {
                  if (sortType === "Neueste") {
                    filteredMarkers.sort((a, b) => new Date(b.date) - new Date(a.date));
                  } else if (sortType === "Älteste") {
                    filteredMarkers.sort((a, b) => new Date(a.date) - new Date(b.date));
                  }
                  
                  renderPage(1); // Reset to the first page after sorting
                }
         
                function createCategoryFilter() {
                  const filterDiv = document.getElementById('category-filter');
                  filterDiv.innerHTML = ''; // Clear existing content
                  const select = document.createElement('select');
                  select.id = 'category-select';
                  select.onchange = function() {
                    filterByCategory(this.value);
                  };
                  const categories = ["Alle", "Transport", "Öffentliche Plätze", "Umwelt", "Verwaltung", "Kultur", "Bildung", "Gesundheit", "Sport", "Andere"];
                  categories.forEach(category => {
                    const option = document.createElement('option');
                    option.value = category;
                    option.innerText = category;
                    select.appendChild(option);
                  });
                  filterDiv.appendChild(select);
                }
         
                function createSortFilter() {
                  const sortDiv = document.getElementById('sort-filter');
                  sortDiv.innerHTML = ''; // Clear existing content
                  const select = document.createElement('select');
                  select.id = 'sort-select';
                  select.onchange = function() {
                    sortMarkers(this.value);
                  };
                  const sortOptions = ["Neueste", "Älteste"];
                  sortOptions.forEach(option => {
                    const optionElement = document.createElement('option');
                    optionElement.value = option;
                    optionElement.innerText = option;
                    select.appendChild(optionElement);
                  });
                  sortDiv.appendChild(select);
                }
                // Call these functions to create filters
                createCategoryFilter();
                createSortFilter();
         
                function paginateMarkers(page, markersPerPage) {
                  const startIndex = (page - 1) * markersPerPage;
                  const endIndex = startIndex + markersPerPage;
                  return filteredMarkers.slice(startIndex, endIndex);
                }
         
                function renderPage(page) {
                  currentPage = parseInt(page);
                  const paginatedMarkers = paginateMarkers(page, markersPerPage);
                  const list = document.getElementById('markers-list');
                  list.innerHTML = '';
                  if (paginatedMarkers.length === 0) {
                    const noMarkersMessage = document.createElement('p');
                    noMarkersMessage.textContent = "Keine Beiträge gefunden!";
                    noMarkersMessage.style.textAlign = 'center';
                    list.appendChild(noMarkersMessage);
                  } else {
                    paginatedMarkers.forEach(marker => {
                      const listItem = document.createElement('li');
                      const displayText = marker.is_mapobject ? marker.descriptionwhy : marker.name;
                      const link = document.createElement('a');
                      link.href = "#";
                      link.style.color = categoryColors[marker.category] || 'black';
                      link.style.fontWeight = marker.is_mapobject ? 'normal' : 'bold';
                      link.style.textDecoration = 'none';
                      link.innerHTML = displayText;
                      link.onclick = function() {
                        centerMapOnMarker(marker.id);
                        return false;
                      };
                      listItem.appendChild(link);
                      list.appendChild(listItem);
                    });
                  }
                }
                window.addEventListener('resize', function() {
                  renderPage(currentPage);
                });
                document.getElementById('show-markers-btn').addEventListener('click', function() {
                  var markersListOverlay = document.getElementById('markers-list-overlay');
                  var showMarkersBtn = this; // Reference the clicked button
                  if (markersListOverlay.style.display === 'block') {
                    // Hide the overlay and change button text to "Liste anzeigen"
                    markersListOverlay.style.display = 'none';
                    showMarkersBtn.innerText = 'Liste anzeigen';
                  } else {
                    // Show the overlay and change button text to "Liste ausblenden"
                    createSortFilter(); // Initialize sorting filter
                    markersListOverlay.style.display = 'block';
                    renderPage(1); // Render the first page of markers
                    showMarkersBtn.innerText = 'Liste ausblenden';
                  }
                });
                // Event listener for the 'Schließen' button
                document.getElementById('close-overlay-button').addEventListener('click', function() {
                  var markersListOverlay = document.getElementById('markers-list-overlay');
                  var showMarkersBtn = document.getElementById('show-markers-btn');
                  // Hide the overlay and change button text to "Liste anzeigen"
                  markersListOverlay.style.display = 'none';
                  showMarkersBtn.innerText = 'Liste anzeigen';
                });
                // Global variable to track the filter state
                // Function to update marker visibility
                // Function to update marker visibility and synchronize button states
                function updateMarkerVisibility() {
                  showFullProjectsOnly = !showFullProjectsOnly;
                  // Retrieve the currently selected category
                  const selectedCategory = document.getElementById('category-select').value;
                  let tempMarkers = markers;
                  if (showFullProjectsOnly) {
                    tempMarkers = tempMarkers.filter(marker => !marker.is_mapobject);
                  }
                  if (selectedCategory !== "Alle") {
                    tempMarkers = tempMarkers.filter(marker => marker.category === selectedCategory);
                  }
                  filteredMarkers = tempMarkers.slice().sort((a, b) => b.id - a.id); // Sortieren by newest
                  renderPage(1); // Reset to the first page after filtering
                  for (var category in categoryLayers) {
                    categoryLayers[category].eachLayer(function(marker) {
                      if (showFullProjectsOnly && marker.options.isMapObject) {
                        map.removeLayer(marker);
                      } else {
                        map.addLayer(marker);
                      }
                    });
                  }
                  // Update the text of both buttons
                  const filterButton = document.getElementById('full-project-filter-button');
                  const hideMarkersButton = document.getElementById('hideNonMapMarkers');
                  if (filterButton) {
                    filterButton.textContent = showFullProjectsOnly ? 'Alles anzeigen' : 'Nur Projektvorschläge anzeigen';
                  }
                  if (hideMarkersButton) {
                    hideMarkersButton.textContent = showFullProjectsOnly ? 'Alles anzeigen' : 'Nur Projektvorschläge anzeigen';
                  }
                }
                // Function to create the full project filter
                function createFullProjectFilter() {
                  const filterDiv = document.getElementById('full-project-filter');
                  filterDiv.innerHTML = ''; // Clear existing content
                  // Create the button
                  const filterButton = document.createElement('button');
                  filterButton.id = 'full-project-filter-button';
                  filterButton.className = 'register-button-f'; // Use your desired class
                  filterButton.textContent = 'Nur Projektvorschläge anzeigen';
                  // Event listener for the button
                  filterButton.addEventListener('click', updateMarkerVisibility);
                  filterDiv.appendChild(filterButton);
                }
                // Button event listener for hideNonMapMarkers button
                document.getElementById('hideNonMapMarkers').addEventListener('click', updateMarkerVisibility);
                // Initialize the filter button
                createFullProjectFilter();
                // Call to create the filter UI
                function updatePaginationControls(page, markersPerPage) {
                  const totalPages = Math.ceil(filteredMarkers.length / markersPerPage);
                  const paginationDiv = document.getElementById('pagination-controls');
                  paginationDiv.innerHTML = '';
                  for (let i = 1; i <= totalPages; i++) {
                    const pageButton = document.createElement('button');
                    pageButton.innerText = i;
                    pageButton.onclick = function() {
                      renderPage(i);
                    };
                    if (i === page) {
                      pageButton.style.fontWeight = 'bold';
                    }
                    paginationDiv.appendChild(pageButton);
                  }
                }
                createCategoryFilter(); // Create category filter
                createSortFilter(); // Create sort filter
                createFullProjectFilter(); // Create full project filter
                renderPage(currentPage);
              }
         
              function updateMarkerIcons() {
                for (var category in categoryLayers) {
                  categoryLayers[category].eachLayer(function(marker) {
                    var pinSize = 24; // Base pin size
                    var outlineSize = 2;
                    var fillColor = getCategoryColor(marker.options.category);
                    var isFeatured = marker.options.isFeatured; // Use the isFeatured option set on the marker
                    var newIcon = createIcon(pinSize, outlineSize, fillColor, isFeatured);
                    marker.setIcon(newIcon);
                  });
                }
              }
              document.addEventListener('click', function(event) {
                // Check if the click is within the voting bar or its child elements
                if (event.target.closest('.voting-bar, .upvotes, .downvotes')) {
                  return; // Exit the function early if click is on the voting bar
                }
                var markerOverlay = document.getElementById('marker-overlay');
                var overlayContent = document.getElementById('overlay-content');
                var navOverlay = document.getElementById('nav-overlay');
                var videoOverlay = document.getElementById('video-overlay'); // First video overlay
                var videoOverlay2 = document.getElementById('video-overlay-2'); // Second video overlay
                // Check if the clicked element is part of the nav-overlay
                if (navOverlay && navOverlay.contains(event.target)) {
                  return; // Exit the function if clicked inside nav-overlay
                }
                // Check if the clicked element is part of the video-overlay
                if (videoOverlay && videoOverlay.contains(event.target)) {
                  return; // Exit the function if clicked inside video-overlay
                }
                // Check if the clicked element is part of the video-overlay-2
                if (videoOverlay2 && videoOverlay2.contains(event.target)) {
                  return; // Exit the function if clicked inside video-overlay-2
                }
                // Close the marker overlay if it is open and the click is outside its content
                if (markerOverlay && markerOverlay.style.display !== 'none' && !overlayContent.contains(event.target)) {
                  markerOverlay.style.display = 'none';
                } else {
                }
              });
              // Function to get color based on category with added debugging
              function getCategoryColor(category) {
                var color;
                switch (category) {
                  case 'Transport':
                    color = '#133873';
                    break;
                  case 'Öffentliche Plätze':
                    color = '#ff5c00';
                    break;
                  case 'Umwelt':
                    color = '#4CAF50';
                    break;
                  case 'Verwaltung':
                    color = '#653993';
                    break;
                  case 'Kultur':
                    color = '#431307';
                    break;
                  case 'Bildung':
                    color = '#eab003';
                    break;
                  case 'Gesundheit':
                    color = '#9A031E';
                    break;
                  case 'Sport':
                    color = '#3d4f53';
                    break;
                  case 'Andere':
                    color = '#212121';
                    break;
                  default:
                    color = '#888'; // Default color
                    break;
                }
                return color;
              }
              var categoryLayers = {}; // Global object to hold category layers
              function logSelectedCategory() {
                var selectedCategory = document.getElementById('marker-category').value;
              }
              var markersById = {};
         
              function addMarkers(projects) {
                projects.forEach(project => {
                  if (project.geoloc) {
                    var coords = project.geoloc.split(',');
                    var latLng = L.latLng(parseFloat(coords[0]), parseFloat(coords[1]));
                    var fillColor = getCategoryColor(project.category);
                    var isFeatured = project.is_featured; // Check if the project is featured
                    var popupContent;
                    // Calculate vote percentages
                    var totalVotes = project.upvotes + project.downvotes;
                    var upvotePercentage = totalVotes > 0 ? ((project.upvotes / totalVotes) * 100).toFixed(1) : 0;
                    var downvotePercentage = totalVotes > 0 ? ((project.downvotes / totalVotes) * 100).toFixed(1) : 0;
                    if (project.is_mapobject) {
                      // For Notizens, show simple description
                      popupContent = `
         											<div style="text-align: center;">${project.descriptionwhy}</div>`;
                    } else {
                      // For Projektvorschläges, show detailed popup with voting details
                      var votingDetailsHtml = `
                            
         											<div style="text-align: center; margin-bottom: 1px; font-size: 14px; font-weight: bold;">
         												<span onclick="vote(${project.id}, 'upvote')" class="vote-button" style="cursor: pointer;">👍</span>: 
         												<span id="upvote-count-${project.id}">${project.upvotes}</span>,
                                
         												<span onclick="vote(${project.id}, 'downvote')" class="vote-button"  style="cursor: pointer;">👎</span>: 
         												<span id="downvote-count-${project.id}">${project.downvotes}</span>
         											</div>
                        `;
                      var votingBarHtml = `
                            
         											<div class="voting-bar" style="margin-top: 1px;">
         												<div class="upvotes" style="width: ${upvotePercentage}%;"></div>
         												<div class="downvotes" style="width: ${downvotePercentage}%;"></div>
         											</div>
                        `;
                      popupContent = `
                            
         											<div style="text-align: center;">
         												<b>${project.name}</b>
         												<br>
         													<img src="/static/usersubmissions/${project.image_file}" style="width:300px; height:auto; object-fit: contain; display: block; margin: 10px auto; border-radius: 30px;">
                                ${votingDetailsHtml}
                                ${votingBarHtml}
                                
         														<a href="/project_details/${project.id}" target="_blank" class="button-hover-effect" style="font-size: 14px; font-weight: bold; color:white !important;">
                                    Details anzeigen
                                </a>
         													</div>
                        `;
                    }
                    var marker = L.marker(latLng, {
                      icon: createIcon(24, 2, fillColor, isFeatured),
                      category: project.category,
                      isMapObject: project.is_mapobject,
                      isFeatured: isFeatured
                    }).addTo(map);
                    marker.bindPopup(popupContent);
                    map.on('popupopen', function(e) {
                      var popupContent = e.popup.getContent();
                      var tempDiv = document.createElement('div');
                      tempDiv.innerHTML = popupContent;
                      var upvoteElement = tempDiv.querySelector('[id^="upvote-count-"]');
                      if (upvoteElement) {
                        var projectId = upvoteElement.id.replace('upvote-count-', '');
                        setInitialVoteBarStyles(projectId);
                      }
                    });
                    markersById[project.id] = marker;
                    if (!categoryLayers[project.category]) {
                      categoryLayers[project.category] = L.layerGroup().addTo(map);
                    }
                    marker.addTo(categoryLayers[project.category]);
                  }
                });
              }
         
              function setInitialVoteBarStyles(projectId) {
                document.querySelectorAll('.voting-bar').forEach(votingBar => {
                  const upvoteElement = votingBar.querySelector('.upvotes');
                  const downvoteElement = votingBar.querySelector('.downvotes');
                  // Adjust border-radius
                  const upvotePercentage = parseFloat(upvoteElement.style.width);
                  const downvotePercentage = parseFloat(downvoteElement.style.width);
                  if (upvotePercentage > 0 && downvotePercentage > 0) {
                    upvoteElement.style.borderRadius = '30px 0 0 30px';
                    downvoteElement.style.borderRadius = '0 30px 30px 0';
                  } else if (upvotePercentage > 0) {
                    upvoteElement.style.borderRadius = '30px';
                    downvoteElement.style.borderRadius = '0';
                  } else if (downvotePercentage > 0) {
                    downvoteElement.style.borderRadius = '30px';
                    upvoteElement.style.borderRadius = '0';
                  }
                  // Attach event listeners for voting
                  upvoteElement.onclick = function() {
                    vote(projectId, 'upvote');
                  };
                  downvoteElement.onclick = function() {
                    vote(projectId, 'downvote');
                  };
                });
              }
              // Call the function on page load
              document.addEventListener('DOMContentLoaded', function() {
                setInitialVoteBarStyles();
              });
         
              function vote(projectId, voteType) {
                // Check if user is logged in
                if (!userLoggedIn) {
                  alert("Melden Sie sich an, um über Projekte abzustimmen.");
                  return;
                }
                fetch(`/vote/${projectId}/${voteType}`, {
                  method: 'POST',
                  headers: {
                    'Content-Type': 'application/json',
                    'Accept': 'application/json'
                  },
                  body: JSON.stringify({
                    'project_id': projectId,
                    'vote_type': voteType
                  })
                }).then(response => response.json()).then(data => {
                  if (data.success) {
                    // Update UI elements
                    updateVotingUI(projectId, data);
                  } else {
                  }
                }).catch(error => {});
              }
         
              function updateVotingUI(projectId, data) {
                var openPopup = null;
                map.eachLayer(function(layer) {
                  // Check if layer has a popup and if it is open
                  if (layer.getPopup && layer.getPopup() && layer.getPopup().isOpen()) {
                    openPopup = layer.getPopup();
                  }
                });
                // Proceed if an open popup is found
                if (openPopup) {
                  // Extract and parse the popup content
                  const popupContent = openPopup.getContent();
                  const parser = new DOMParser();
                  const popupDoc = parser.parseFromString(popupContent, 'text/html');
                  // Update the voting counts and percentages
                  const upvoteCountElement = popupDoc.getElementById(`upvote-count-${projectId}`);
                  const downvoteCountElement = popupDoc.getElementById(`downvote-count-${projectId}`);
                  const upvotePercentage = data.upvote_percentage.toFixed(1);
                  const downvotePercentage = data.downvote_percentage.toFixed(1);
                  if (upvoteCountElement) upvoteCountElement.innerText = `${data.upvote_count}`;
                  if (downvoteCountElement) downvoteCountElement.innerText = `${data.downvote_count}`;
                  // Update voting bars widths and adjust border-radius
                  const upvotesBar = popupDoc.querySelector(`.upvotes`);
                  const downvotesBar = popupDoc.querySelector(`.downvotes`);
                  if (upvotesBar && downvotesBar) {
                    upvotesBar.style.width = `${upvotePercentage}%`;
                    downvotesBar.style.width = `${downvotePercentage}%`;
                    if (data.upvote_count > 0 && data.downvote_count > 0) {
                      upvotesBar.style.borderRadius = '30px 0 0 30px';
                      downvotesBar.style.borderRadius = '0 30px 30px 0';
                    } else if (data.upvote_count > 0 && data.downvote_count === 0) {
                      upvotesBar.style.borderRadius = '30px';
                      downvotesBar.style.borderRadius = '0';
                    } else if (data.upvote_count === 0 && data.downvote_count > 0) {
                      downvotesBar.style.borderRadius = '30px';
                      upvotesBar.style.borderRadius = '0';
                    }
                  }
                  // Update popup content with the modified HTML
                  openPopup.setContent(popupDoc.documentElement.innerHTML);
                }
                setInitialVoteBarStyles(projectId); // Call this at the end of the function
              }
         
              function adjustBorderRadius(upvoteElement, downvoteElement, upvoteCount, downvoteCount) {
                if (upvoteCount > 0 && downvoteCount > 0) {
                  upvoteElement.style.borderRadius = '30px 0 0 30px';
                  downvoteElement.style.borderRadius = '0 30px 30px 0';
                } else if (upvoteCount > 0 && downvoteCount === 0) {
                  upvoteElement.style.borderRadius = '30px';
                } else if (upvoteCount === 0 && downvoteCount > 0) {
                  downvoteElement.style.borderRadius = '30px';
                }
              }
         
              function loadMoreMarkers() {
                const list = document.getElementById('markers-list');
                const showMoreBtn = document.getElementById('show-more-markers');
                // Determine the next set of markers to display
                const nextMarkers = allMarkers.slice(displayedMarkersCount, displayedMarkersCount + markersPerPage);
                nextMarkers.forEach(marker => {
                  // Create list item for each marker
                  const listItem = document.createElement('li');
                  const displayText = marker.is_mapobject ? marker.descriptionwhy : marker.name;
                  const link = document.createElement('a');
                  link.href = "#";
                  link.style.color = categoryColors[marker.category] || 'black';
                  link.style.fontWeight = marker.is_mapobject ? 'normal' : 'bold';
                  link.style.textDecoration = 'none';
                  link.innerHTML = displayText;
                  link.onclick = function() {
                    centerMapOnMarker(marker.id);
                    return false;
                  };
                  listItem.appendChild(link);
                  list.appendChild(listItem);
                });
                // Update the count of displayed markers
                displayedMarkersCount += nextMarkers.length;
                // Check if there are more markers to show
                if (displayedMarkersCount < allMarkers.length) {
                  showMoreBtn.style.display = 'block'; // Show the "Show More" button
                  showMoreBtn.classList.add('register-button-f');
                } else {
                  showMoreBtn.style.display = 'none'; // Hide the button if no more markers
                }
              }
              fetch('/get_projects').then(response => {
                if (!response.ok) {
                  throw new Error(`HTTP error! Status: ${response.status}`);
                }
                return response.json();
              }).then(data => {
                const sortedData = sortMarkersByNewest(data); // Sortieren data by newest
                addMarkers(sortedData); // Add markers to the map in sorted order
                createCategoryButtons();
                updateCategoryButtonColors(); // Update category button colors
                // Ensure markers in the overlay are sorted by newest
                addMarkersToOverlay(sortedData);
              }).catch(error => {});
         
              function sortMarkersByNewest(markers) {
                return markers.sort((a, b) => new Date(b.date) - new Date(a.date));
              }
              var markersListOverlay = document.getElementById('markers-list-overlay');
         
         
         
         function containsSwearWords(text, language) {
          var words = swearWords[language] || [];
          var textWords = text.toLowerCase().split(/\s+/);
          return textWords.some(word => words.includes(word));
         }
         
         
         
         
         
         function centerMapOnMarker(markerId) {
          var marker = markersById[markerId];
          if (marker) {
            var markerLatLng = marker.getLatLng();
            var popup = marker.getPopup();
         
            // Temporarily open the popup offscreen to measure its size if it's not already open
            var wasPopupOpen = map.hasLayer(popup);
            if (!wasPopupOpen) {
              popup.setLatLng(new L.LatLng(-90, -180)); // Offscreen position
              popup.openOn(map);
            }
         
            // Measure the popup size or use default values
            var popupWidth = popup.getElement() ? popup.getElement().clientWidth : 300; // Default width
            var popupHeight = popup.getElement() ? popup.getElement().clientHeight : 200; // Default height
         
            // Close the popup if it was not originally open
            if (!wasPopupOpen) {
              map.closePopup(popup);
            }
         
            var xOffset = 0;
            var yOffset = 0;
            // Adjust offsets for mobile screens
            if (window.innerWidth <= 1080) {
              xOffset = 0; // Adjust xOffset as needed based on mobile layout
              yOffset = popupHeight / 4 + 20; // Adjust yOffset as needed to center on mobile, and additional 20 pixels to move it below
            } else {
              yOffset = 20; // For non-mobile, move the marker 20px below the center
            }
         
            // Calculate the new center of the map
            var point = map.project(markerLatLng, map.getZoom()).subtract([xOffset, yOffset]);
            var newCenter = map.unproject(point, map.getZoom());
         
            // Set the map view to the new position
            map.setView(newCenter, map.getZoom());
         
            // Open the popup after a short delay to allow the map to finish moving
            setTimeout(function() {
              marker.openPopup();
            }, 300); // 300 milliseconds delay
         
            // Close the markers list overlay on mobile and tablet, and update button text
            if (window.innerWidth <= 1080) {
              var sidebar = document.getElementById('markers-list-overlay');
              sidebar.style.display = 'none';
              var showMarkersBtn = document.getElementById('show-markers-btn');
              showMarkersBtn.innerText = 'Liste anzeigen';
            }
          } else {
          }
         }
         
         
         
         
         
              function createCategoryButtons() {
                var container = document.getElementById('category-toggle-buttons');
                for (var category in categoryLayers) {
                  var wrapperDiv = document.createElement('div');
                  wrapperDiv.style.textAlign = 'center';
                  // Create the category button
                  var button = document.createElement('button');
                  button.innerText = `${category} (${categoryLayers[category].getLayers().length} Beiträge)`;
                  button.setAttribute('category-name', category);
                  // Apply custom styles to the button
                  button.style.fontWeight = 'bold';
                  button.style.lineHeight = '1';
                  button.style.cursor = 'pointer';
                  button.style.textDecoration = 'none';
                  button.style.display = 'flex';
                  button.style.alignItems = 'center';
                  button.style.justifyContent = 'center';
                  button.style.width = '97%';
                  button.style.height = 'auto';
                  button.style.boxSizing = 'border-box';
                  button.style.transition = 'background-color 0.2s ease-in-out';
                  button.style.borderRadius = '30px';
                  button.style.textAlign = 'center';
                  button.style.border = 'none'; // Ensure no border is applied
                  button.style.outline = 'none'; // Remove any focus outline
                  button.style.boxShadow = 'none'; // Remove any shadow that might appear as an outline
                  button.style.flexGrow = '1';
                  button.style.flexShrink = '1';
                  button.style.padding = '7px';
                  button.style.margin = '7px auto';
                  button.style.fontSize = '18px';
                  button.style.color = 'white';
                  button.style.backgroundColor = getCategoryColor(category);
                  applyButtonStyles(button);
                  setButtonState(button, category);
                  // Add faded effect if the layer is not initially visible
                  if (!map.hasLayer(categoryLayers[category])) {
                    button.classList.add('faded');
                  }
                  // Set onclick event
                  button.onclick = function() {
                    toggleCategory(this.innerText);
                    setButtonState(this, this.getAttribute('category-name'));
                  };
                  wrapperDiv.appendChild(button);
                  container.appendChild(wrapperDiv);
                }
              }
         
              function setButtonState(button, category) {
                if (map.hasLayer(categoryLayers[category])) {
                  button.classList.remove('faded');
                } else {
                  button.classList.add('faded');
                }
              }
         
              function applyButtonStyles(button) {
                button.style.fontWeight = 'bold';
                // ... rest of the styling ...
              }
         
              function toggleCategory(categoryName) {
                for (var category in categoryLayers) {
                  if (categoryLayers.hasOwnProperty(category)) {
                    var layer = categoryLayers[category];
                    var button = document.querySelector(`button[category-name="${category}"]`);
                    if (categoryName === `${category} (${layer.getLayers().length} Beiträge)`) {
                      if (map.hasLayer(layer)) {
                        map.removeLayer(layer);
                        button.classList.add('faded');
                      } else {
                        map.addLayer(layer);
                        button.classList.remove('faded');
                      }
                    }
                  }
                }
              }
         
              function updateCategoryButtonColors() {
                const categoryColors = {
                  'Transport': '#133873',
                  'Öffentliche Plätze': '#ff5c00',
                  'Umwelt': '#4CAF50',
                  'Verwaltung': '#653993',
                  'Kultur': '#431307',
                  'Bildung': '#eab003',
                  'Gesundheit': '#9A031E',
                  'Sport': '#3d4f53',
                  'Andere': '#212121'
                };
                const categoryButtons = document.querySelectorAll('#category-toggle-buttons button');
                categoryButtons.forEach(button => {
                  const buttonText = button.textContent.trim();
                  const categoryMatch = buttonText.match(/^(.*?)(?=\s*\()/); // Use regex to extract the category name before the "("
                  const category = categoryMatch ? categoryMatch[0].trim() : "";
                  const color = categoryColors[category];
                  if (color) {
                    button.style.backgroundColor = color;
                  }
                });
              }
              // Call the function after the buttons are added to the DOM
              updateCategoryButtonColors();
              let selectedLatLng;
              // Variable to store the selected latitude and longitude
              // Add this function in your JavaScript
              function saveMarkerData(latlng, category, description, callback) {
                var isAuthenticated = false /* logic to determine if the user is authenticated */
                var dataToSend = {
                  lat: latlng.lat,
                  lng: latlng.lng,
                  category: category,
                  description: description,
                  isAnonymous: !isAuthenticated
                };
                $.ajax({
                  url: '/add_marker',
                  method: 'POST',
                  data: JSON.stringify(dataToSend),
                  contentType: 'application/json; charset=utf-8',
                  dataType: 'json',
                  success: function(response) {
                    if (callback) {
                      callback(response); // Execute the callback with the response data
                    }
                    checkMarkerLimit();
                  },
                  error: function(xhr, textStatus, errorThrown) {
                    if (xhr.status === 429) {
                      alert("Sie haben Ihr Tageslimit für das Hinzufügen von Markierungen erreicht. Versuchen Sie es später noch einmal.");
                    } else {
                    }
                  }
                });
              }
         
              function checkMarkerLimit() {
                fetch('/check_marker_limit').then(response => response.json()).then(data => {
                  const limitInfoElement = document.getElementById('limit-info');
                  if (data.limit_reached) {
                    document.getElementById('add-marker-button').disabled = true;
                    document.getElementById('open-overlay').disabled = true;
                    startTimer(data.reset_time);
                    limitInfoElement.textContent = `Sie haben Ihr Tageslimit von ${data.max_limit} Markierungen erreicht.`;
                  } else {
                    const markersRemaining = data.max_limit - data.current_count;
                    limitInfoElement.textContent = `Sie haben heute schon ${data.current_count} / 10 Markierungen gepostet.`;
                  }
                }).catch(error => {
                  const limitInfoElement = document.getElementById('limit-info');
                  limitInfoElement.textContent = "Fehler beim Abrufen der Marker-Limit-Informationen.";
                });
              }
              // Call checkMarkerLimit on page load
              document.addEventListener('DOMContentLoaded', function() {
                checkMarkerLimit();
              });
              // Timer function
              function startTimer(expiryTime) {
                if (!expiryTime) return; // Add this check
                var countDownDate = new Date(expiryTime).getTime();
                var addButton = document.getElementById('add-marker-button');
                var overlayButton = document.getElementById('open-overlay');
                var interval = setInterval(function() {
                  var now = new Date().getTime();
                  var distance = countDownDate - now;
                  var hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                  var minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                  var seconds = Math.floor((distance % (1000 * 60)) / 1000);
                  var timerText = `Limit erreicht, läuft in ${hours}h${minutes}m ab`;
                  addButton.innerText = timerText;
                  overlayButton.innerText = timerText;
                  if (distance < 0) {
                    clearInterval(interval);
                    addButton.innerText = "Hinzufügen";
                    addButton.disabled = false;
                    overlayButton.innerText = "Hinzufügen";
                    overlayButton.disabled = false;
                  }
                }, 1000);
              }
              // Function for updating character count on textarea
              function updateTextareaCharCountFeedback(textareaElement, feedbackElement, minLimit, maxLimit) {
                var charCount = textareaElement.value.length;
                var charRemaining = maxLimit - charCount;
                if (charCount < minLimit) {
                  feedbackElement.textContent = `Sie müssen noch ${minLimit - charCount} Zeichen eingeben.`;
                } else if (charCount <= maxLimit) {
                  feedbackElement.textContent = `Sie können noch ${charRemaining} Zeichen eingeben.`;
                } else {
                  feedbackElement.textContent = "Zeichenlimit erreicht.";
                  textareaElement.value = textareaElement.value.substring(0, maxLimit);
                }
                feedbackElement.style.color = '#003056';
              }
              // Create a feedback element for the marker description textarea
              var markerDescriptionTextarea = document.getElementById('marker-description');
              var markerDescriptionFeedback = document.createElement('div');
              markerDescriptionFeedback.id = 'markerDescriptionFeedback';
              markerDescriptionTextarea.parentNode.insertBefore(markerDescriptionFeedback, markerDescriptionTextarea.nextSibling);
              // Event listener for the marker description textarea
              markerDescriptionTextarea.addEventListener('input', function() {
                updateTextareaCharCountFeedback(markerDescriptionTextarea, markerDescriptionFeedback, 15, 300);
              });
              updateTextareaCharCountFeedback(markerDescriptionTextarea, markerDescriptionFeedback, 15, 300); // Initial update
            
      </script>
      <script>
         // Toggle the navigation overlay
         function toggleNavOverlay() {
           var navOverlay = document.getElementById('nav-overlay');
           if (navOverlay.style.display === 'block') {
             navOverlay.style.display = 'none';
           } else {
             navOverlay.style.display = 'block';
           }
         }
         // Close the navigation overlay when clicking on the overlay background or on a non-button element
         document.getElementById('nav-overlay').addEventListener('click', function(event) {
           // Close only if on mobile
           if (window.innerWidth <= 1080 && !event.target.closest('button, a')) {
             toggleNavOverlay();
           }
         });
         // Event listener for hamburger button
         document.getElementById('hamburger-button').addEventListener('click', toggleNavOverlay);
         // Resize event listener
         window.addEventListener('resize', function() {
           var navOverlay = document.getElementById('nav-overlay');
           // Show on desktop, hide on mobile
           if (window.innerWidth > 1080) {
             navOverlay.style.display = 'block';
           } else {
             navOverlay.style.display = 'none';
           }
         });
         // Set initial state of the nav-overlay based on device width
         window.onload = function() {
           var navOverlay = document.getElementById('nav-overlay');
           // Show on desktop, hide on mobile
           if (window.innerWidth > 1080) {
             navOverlay.style.display = 'block';
           } else {
             navOverlay.style.display = 'none';
           }
         };
      </script>
      <script>
         document.addEventListener('DOMContentLoaded', function() {
           var submitButton = document.getElementById('add-marker-button'); // Assuming this is your submit button's ID
           submitButton.addEventListener('click', validateMarkerDescription);
         });
         
         function validateMarkerDescription(event) {
           var description = document.getElementById('marker-description').value;
         
           // Check for spammy content
           if (isSpam(description)) {
             event.preventDefault(); // Prevent form submission
             return false;
           }
         
           // Add more validation checks as needed
         }
         
         
      </script>
      <script>
         document.getElementById('info-link').addEventListener('click', function(e) {
           e.preventDefault();
           openVideoOverlay('youtube-iframe', 'video-overlay', 'aXB8KE_gpm8', 'V7EjnHuLZjI');
         });
         document.getElementById('info-link2').addEventListener('click', function(e) {
           e.preventDefault();
           openVideoOverlay('youtube-iframe-2', 'video-overlay-2', '9-bWivUusZ4', '9xEXWG8TybY');
         });
         
         function openVideoOverlay(iframeId, overlayId, desktopVideoId, mobileVideoId) {
           var iframe = document.getElementById(iframeId);
           var videoId = window.innerWidth > 1080 ? desktopVideoId : mobileVideoId; // Choose video based on screen width
           iframe.src = 'https://www.youtube.com/embed/' + videoId + '?autoplay=1&mute=1&enablejsapi=1';
           document.getElementById(overlayId).style.display = 'flex';
         }
         
         function closeVideoOverlay(iframeId, overlayId) {
           var iframe = document.getElementById(iframeId);
           if (iframe.src) {
               iframe.src = '';
           }
           document.getElementById(overlayId).style.display = 'none';
         }
         // Initialize YouTube API
         var tag = document.createElement('script');
         tag.src = "https://www.youtube.com/iframe_api";
         var firstScriptTag = document.getElementsByTagName('script')[0];
         firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
         var player, player2;
         
         function onYouTubeIframeAPIReady() {
           player = new YT.Player('youtube-iframe', {
             videoId: 'aXB8KE_gpm8',
             events: {
               'onStateChange': onPlayerStateChange
             }
           });
           player2 = new YT.Player('youtube-iframe-2', {
             videoId: '9-bWivUusZ4',
             events: {
               'onStateChange': onPlayerStateChange2
             }
           });
         }
         
         function onPlayerStateChange(event) {
           if (event.data === YT.PlayerState.ENDED) {
             showReplayImage('youtube-iframe', 'replay-container');
           }
         }
         
         function onPlayerStateChange2(event) {
           if (event.data === YT.PlayerState.ENDED) {
             showReplayImage('youtube-iframe-2', 'replay-container-2');
           }
         }
         
         function showReplayImage(iframeId, containerId) {
           var iframe = document.getElementById(iframeId);
           iframe.style.display = 'none';
           var replayContainer = document.getElementById(containerId);
           replayContainer.style.display = 'flex';
           var replayImg = document.createElement('img');
           replayImg.id = 'replay-image';
           replayImg.src = '{{ url_for("static", filename="replay.png") }}';
           replayImg.addEventListener('click', function() {
             replayVideo(iframeId, containerId);
           });
           replayContainer.innerHTML = '';
           replayContainer.appendChild(replayImg);
         }
         
         function replayVideo(iframeId, containerId) {
           var replayContainer = document.getElementById(containerId);
           replayContainer.style.display = 'none';
           var iframe = document.getElementById(iframeId);
           iframe.style.display = 'block';
           var playerToUse = iframeId === 'youtube-iframe' ? player : player2;
           playerToUse.seekTo(0);
           playerToUse.playVideo();
         }
         // Event listeners for closing overlays
         document.getElementById('video-overlay').addEventListener('click', function(event) {
           if (!event.target.closest('#youtube-iframe, #replay-image')) {
             closeVideoOverlay('youtube-iframe', 'video-overlay');
           }
         });
         document.getElementById('video-overlay-2').addEventListener('click', function(event) {
           if (!event.target.closest('#youtube-iframe-2, #replay-image')) {
             closeVideoOverlay('youtube-iframe-2', 'video-overlay-2');
           }
         });
      </script>
   </body>
</html>